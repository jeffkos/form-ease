<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FormEase - Dashboard Premium (Corrigé)</title>
    
    <!-- Tremor/Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js for advanced charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Remix Icons -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.0.0/fonts/remixicon.css" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        tremor: {
                            brand: {
                                faint: "#eff6ff",
                                muted: "#bfdbfe", 
                                subtle: "#60a5fa",
                                DEFAULT: "#3b82f6",
                                emphasis: "#1d4ed8",
                                inverted: "#ffffff",
                            },
                            background: {
                                muted: "#f9fafb",
                                subtle: "#f3f4f6", 
                                DEFAULT: "#ffffff",
                                emphasis: "#374151",
                            },
                            border: {
                                DEFAULT: "#e5e7eb",
                            },
                            content: {
                                subtle: "#9ca3af",
                                DEFAULT: "#6b7280", 
                                emphasis: "#374151",
                                strong: "#111827",
                                inverted: "#ffffff",
                            }
                        }
                    }
                }
            }
        };
    </script>
    
    <style>
        .drag-over {
            border-color: #3b82f6 !important;
            background-color: #eff6ff !important;
        }
        
        .dragging {
            opacity: 0.5;
        }
        
        .field-preview {
            transition: all 0.2s ease;
        }
        
        .field-preview:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script>
        // Simple state management
        let appState = {
            showFormBuilder: false,
            draggedFieldType: null,
            fields: [],
            formSettings: {
                title: 'Mon Nouveau Formulaire',
                description: 'Décrivez votre formulaire ici...',
                submitButtonText: 'Envoyer'
            }
        };

        // Field templates
        const fieldTemplates = {
            text: { icon: 'ri-input-cursor-move', label: 'Texte simple', placeholder: 'Entrez votre texte...' },
            textarea: { icon: 'ri-file-text-line', label: 'Zone de texte', placeholder: 'Entrez votre message...' },
            email: { icon: 'ri-mail-line', label: 'Email', placeholder: 'email@exemple.com' },
            phone: { icon: 'ri-phone-line', label: 'Téléphone', placeholder: '+33 1 23 45 67 89' },
            url: { icon: 'ri-links-line', label: 'URL', placeholder: 'https://...' },
            number: { icon: 'ri-hashtag', label: 'Nombre', placeholder: '0' },
            select: { icon: 'ri-arrow-down-s-line', label: 'Liste déroulante', options: ['Option 1', 'Option 2', 'Option 3'] },
            radio: { icon: 'ri-radio-button-line', label: 'Choix unique', options: ['Choix 1', 'Choix 2', 'Choix 3'] },
            checkbox: { icon: 'ri-checkbox-line', label: 'Choix multiples', options: ['Option A', 'Option B', 'Option C'] },
            date: { icon: 'ri-calendar-line', label: 'Date', placeholder: 'jj/mm/aaaa' },
            time: { icon: 'ri-time-line', label: 'Heure', placeholder: 'hh:mm' },
            file: { icon: 'ri-upload-line', label: 'Upload fichier', accept: '*' },
            rating: { icon: 'ri-star-line', label: 'Évaluation', max: 5 }
        };

        // Utility functions
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function updateState(newState) {
            appState = { ...appState, ...newState };
            render();
        }

        function addField(fieldType) {
            const template = fieldTemplates[fieldType];
            if (!template) return;

            const newField = {
                id: generateId(),
                type: fieldType,
                label: template.label,
                placeholder: template.placeholder || '',
                required: false,
                options: template.options ? [...template.options] : [],
                ...template
            };

            updateState({
                fields: [...appState.fields, newField]
            });
        }

        function removeField(fieldId) {
            updateState({
                fields: appState.fields.filter(field => field.id !== fieldId)
            });
        }

        function updateField(fieldId, updates) {
            updateState({
                fields: appState.fields.map(field => 
                    field.id === fieldId ? { ...field, ...updates } : field
                )
            });
        }

        function moveField(fromIndex, toIndex) {
            const newFields = [...appState.fields];
            const [movedField] = newFields.splice(fromIndex, 1);
            newFields.splice(toIndex, 0, movedField);
            updateState({ fields: newFields });
        }

        // Drag and Drop handlers
        function handleDragStart(event, fieldType) {
            event.dataTransfer.setData('text/plain', fieldType);
            appState.draggedFieldType = fieldType;
            event.target.classList.add('dragging');
        }

        function handleDragEnd(event) {
            event.target.classList.remove('dragging');
            appState.draggedFieldType = null;
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(event) {
            event.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('drag-over');
            
            const fieldType = event.dataTransfer.getData('text/plain');
            if (fieldType && fieldTemplates[fieldType]) {
                addField(fieldType);
            }
        }

        // Create form field component
        function createFormField(field, index) {
            const template = fieldTemplates[field.type];
            
            const fieldContainer = document.createElement('div');
            fieldContainer.className = 'group border border-gray-200 rounded-lg p-4 hover:border-blue-300 transition-colors bg-white field-preview';
            
            fieldContainer.innerHTML = `
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center">
                        <i class="${template.icon} text-gray-600 mr-2"></i>
                        <span class="text-sm font-medium text-gray-900">${template.label}</span>
                        ${field.required ? '<span class="text-red-500 ml-1">*</span>' : ''}
                    </div>
                    <div class="flex items-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity">
                        ${index > 0 ? `<button onclick="moveField(${index}, ${index - 1})" class="p-1 text-gray-400 hover:text-gray-600"><i class="ri-arrow-up-line"></i></button>` : ''}
                        ${index < appState.fields.length - 1 ? `<button onclick="moveField(${index}, ${index + 1})" class="p-1 text-gray-400 hover:text-gray-600"><i class="ri-arrow-down-line"></i></button>` : ''}
                        <button onclick="removeField('${field.id}')" class="p-1 text-red-400 hover:text-red-600"><i class="ri-delete-bin-line"></i></button>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">Libellé</label>
                        <input type="text" value="${field.label}" onchange="updateField('${field.id}', {label: this.value})" 
                               class="w-full text-sm border border-gray-300 rounded px-3 py-2 bg-white">
                    </div>
                    
                    <div class="bg-gray-50 border border-gray-200 rounded p-3">
                        <label class="block text-sm font-medium text-gray-900 mb-2">${field.label}</label>
                        ${createFieldPreview(field)}
                    </div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" ${field.required ? 'checked' : ''} 
                               onchange="updateField('${field.id}', {required: this.checked})"
                               class="mr-2 rounded border-gray-300">
                        <label class="text-xs text-gray-600">Champ obligatoire</label>
                    </div>
                </div>
            `;
            
            return fieldContainer;
        }

        function createFieldPreview(field) {
            switch (field.type) {
                case 'textarea':
                    return `<textarea placeholder="${field.placeholder}" class="w-full px-3 py-2 border border-gray-300 rounded resize-none" rows="3" disabled></textarea>`;
                case 'select':
                    return `<select class="w-full px-3 py-2 border border-gray-300 rounded bg-white" disabled>
                        ${field.options.map(option => `<option>${option}</option>`).join('')}
                    </select>`;
                case 'radio':
                    return field.options.map((option, i) => 
                        `<div class="flex items-center mb-2">
                            <input type="radio" name="preview-${field.id}" ${i === 0 ? 'checked' : ''} class="mr-2" disabled>
                            <label class="text-sm text-gray-700">${option}</label>
                        </div>`
                    ).join('');
                case 'checkbox':
                    return field.options.map(option => 
                        `<div class="flex items-center mb-2">
                            <input type="checkbox" class="mr-2 rounded" disabled>
                            <label class="text-sm text-gray-700">${option}</label>
                        </div>`
                    ).join('');
                case 'rating':
                    return `<div class="flex space-x-1">
                        ${Array.from({length: field.max || 5}, (_, i) => 
                            `<i class="ri-star-line text-yellow-400 text-xl cursor-pointer hover:text-yellow-500"></i>`
                        ).join('')}
                    </div>`;
                case 'date':
                    return `<input type="date" class="w-full px-3 py-2 border border-gray-300 rounded" disabled>`;
                case 'time':
                    return `<input type="time" class="w-full px-3 py-2 border border-gray-300 rounded" disabled>`;
                case 'file':
                    return `<div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center">
                        <i class="ri-upload-line text-2xl text-gray-400 mb-2"></i>
                        <p class="text-sm text-gray-500">Cliquez ou glissez pour uploader</p>
                    </div>`;
                default:
                    return `<input type="${field.type}" placeholder="${field.placeholder}" class="w-full px-3 py-2 border border-gray-300 rounded" disabled>`;
            }
        }

        // Render main dashboard
        function renderDashboard() {
            return `
                <div class="min-h-screen bg-gray-50">
                    <!-- Top Navigation -->
                    <div class="bg-white border-b border-gray-200 px-6 py-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <h1 class="text-2xl font-bold text-gray-900 mr-8">FormEase</h1>
                                <nav class="flex space-x-6">
                                    <a href="#" class="text-blue-600 font-medium">Formulaires</a>
                                    <a href="#" class="text-gray-600 hover:text-gray-900">Analytics</a>
                                    <a href="#" class="text-gray-600 hover:text-gray-900">Intégrations</a>
                                    <a href="#" class="text-gray-600 hover:text-gray-900">Paramètres</a>
                                </nav>
                            </div>
                            <div class="flex items-center space-x-4">
                                <button onclick="updateState({showFormBuilder: true})" 
                                        class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center">
                                    <i class="ri-add-line mr-2"></i>
                                    Nouveau Formulaire
                                </button>
                                <div class="w-8 h-8 bg-gray-300 rounded-full"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Stats Cards -->
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                            <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                                <div class="flex items-center">
                                    <div class="p-3 bg-blue-100 rounded-lg mr-4">
                                        <i class="ri-file-list-3-line text-blue-600 text-xl"></i>
                                    </div>
                                    <div>
                                        <p class="text-2xl font-bold text-gray-900">24</p>
                                        <p class="text-sm text-gray-600">Formulaires actifs</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                                <div class="flex items-center">
                                    <div class="p-3 bg-green-100 rounded-lg mr-4">
                                        <i class="ri-mail-line text-green-600 text-xl"></i>
                                    </div>
                                    <div>
                                        <p class="text-2xl font-bold text-gray-900">1,247</p>
                                        <p class="text-sm text-gray-600">Réponses ce mois</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                                <div class="flex items-center">
                                    <div class="p-3 bg-yellow-100 rounded-lg mr-4">
                                        <i class="ri-eye-line text-yellow-600 text-xl"></i>
                                    </div>
                                    <div>
                                        <p class="text-2xl font-bold text-gray-900">8,742</p>
                                        <p class="text-sm text-gray-600">Vues totales</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                                <div class="flex items-center">
                                    <div class="p-3 bg-purple-100 rounded-lg mr-4">
                                        <i class="ri-percent-line text-purple-600 text-xl"></i>
                                    </div>
                                    <div>
                                        <p class="text-2xl font-bold text-gray-900">14.3%</p>
                                        <p class="text-sm text-gray-600">Taux de conversion</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Render form builder
        function renderFormBuilder() {
            if (!appState.showFormBuilder) return '';

            const fieldCategories = [
                {
                    name: 'Champs de base',
                    fields: ['text', 'textarea', 'email', 'phone', 'url', 'number']
                },
                {
                    name: 'Choix et sélection',
                    fields: ['select', 'radio', 'checkbox', 'rating']
                },
                {
                    name: 'Date et heure',
                    fields: ['date', 'time']
                },
                {
                    name: 'Médias et fichiers',
                    fields: ['file']
                }
            ];

            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex">
                    <div class="bg-white w-full max-w-7xl mx-auto my-4 rounded-lg overflow-hidden flex">
                        <!-- Sidebar - Field Palette -->
                        <div class="w-80 bg-gray-50 border-r border-gray-200 p-6 overflow-y-auto">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-lg font-semibold text-gray-900">Éléments</h3>
                                <button onclick="updateState({showFormBuilder: false})" 
                                        class="text-gray-400 hover:text-gray-600">
                                    <i class="ri-close-line text-xl"></i>
                                </button>
                            </div>
                            
                            ${fieldCategories.map(category => `
                                <div class="mb-6">
                                    <h4 class="text-sm font-medium text-gray-700 mb-3">${category.name}</h4>
                                    <div class="grid grid-cols-2 gap-2">
                                        ${category.fields.map(fieldType => {
                                            const template = fieldTemplates[fieldType];
                                            return `
                                                <div draggable="true" 
                                                     ondragstart="handleDragStart(event, '${fieldType}')"
                                                     ondragend="handleDragEnd(event)"
                                                     onclick="addField('${fieldType}')"
                                                     class="p-3 bg-white border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 cursor-pointer transition-colors text-center">
                                                    <i class="${template.icon} text-xl text-gray-600 mb-2"></i>
                                                    <p class="text-xs text-gray-900 font-medium">${template.label}</p>
                                                </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- Main Form Builder Area -->
                        <div class="flex-1 flex flex-col">
                            <!-- Form Builder Header -->
                            <div class="bg-white border-b border-gray-200 p-6">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-4">
                                        <input type="text" value="${appState.formSettings.title}" 
                                               onchange="updateState({formSettings: {...appState.formSettings, title: this.value}})"
                                               class="text-xl font-semibold bg-transparent border-none outline-none text-gray-900">
                                        <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">Brouillon</span>
                                    </div>
                                    <div class="flex items-center space-x-3">
                                        <button class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm flex items-center">
                                            <i class="ri-eye-line mr-2"></i>Aperçu
                                        </button>
                                        <button class="px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm flex items-center">
                                            <i class="ri-save-line mr-2"></i>Sauvegarder
                                        </button>
                                        <button class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm flex items-center font-medium">
                                            <i class="ri-share-line mr-2"></i>Publier
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Form Canvas -->
                            <div class="flex-1 overflow-y-auto p-6 bg-gray-50">
                                <div class="max-w-2xl mx-auto">
                                    <div id="form-canvas" 
                                         class="bg-white rounded-lg shadow-sm border border-gray-200 min-h-96"
                                         ondrop="handleDrop(event)" 
                                         ondragover="handleDragOver(event)"
                                         ondragleave="handleDragLeave(event)">
                                        
                                        <!-- Form Header -->
                                        <div class="p-6 border-b border-gray-200">
                                            <input type="text" value="${appState.formSettings.title}"
                                                   onchange="updateState({formSettings: {...appState.formSettings, title: this.value}})"
                                                   class="text-2xl font-bold w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-500"
                                                   placeholder="Titre du formulaire">
                                            <textarea onchange="updateState({formSettings: {...appState.formSettings, description: this.value}})"
                                                      class="w-full mt-2 text-gray-600 bg-transparent border-none outline-none resize-none placeholder-gray-400"
                                                      rows="2" placeholder="Description du formulaire">${appState.formSettings.description}</textarea>
                                        </div>
                                        
                                        <!-- Form Fields -->
                                        <div class="p-6" id="form-fields">
                                            ${appState.fields.length === 0 ? `
                                                <div class="text-center py-12 text-gray-500">
                                                    <i class="ri-drag-drop-line text-6xl mb-4 text-gray-300"></i>
                                                    <h3 class="text-lg font-medium mb-2">Commencez à construire votre formulaire</h3>
                                                    <p class="text-sm mb-4">Glissez des éléments depuis la palette ou cliquez pour les ajouter</p>
                                                    <div class="flex justify-center space-x-2">
                                                        <button onclick="addField('text')" 
                                                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">
                                                            Ajouter un champ texte
                                                        </button>
                                                        <button onclick="addField('email')" 
                                                                class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm">
                                                            Ajouter un email
                                                        </button>
                                                    </div>
                                                </div>
                                            ` : `
                                                <div class="space-y-6" id="fields-container">
                                                    <!-- Fields will be rendered here -->
                                                </div>
                                                <div class="pt-6 border-t border-gray-200 mt-6">
                                                    <button type="submit" 
                                                            class="w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 font-medium transition-colors">
                                                        ${appState.formSettings.submitButtonText}
                                                    </button>
                                                </div>
                                            `}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Main render function
        function render() {
            const root = document.getElementById('root');
            root.innerHTML = renderDashboard() + renderFormBuilder();
            
            // Render form fields if form builder is open and has fields
            if (appState.showFormBuilder && appState.fields.length > 0) {
                const fieldsContainer = document.getElementById('fields-container');
                if (fieldsContainer) {
                    fieldsContainer.innerHTML = '';
                    appState.fields.forEach((field, index) => {
                        fieldsContainer.appendChild(createFormField(field, index));
                    });
                }
            }
        }

        // Initialize app
        render();
    </script>
</body>
</html>
