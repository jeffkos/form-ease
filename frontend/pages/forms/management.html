<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mes Formulaires - FormEase</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.0.0/fonts/remixicon.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <!-- FormEase Functions -->
    <!-- <script src="../../../formease-functions.js"></script> -->
    <!-- FormEase Functions -->
    <!-- <script src="../../formease-functions.js"></script> -->
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        tremor: {
                            brand: {
                                faint: '#f0f9ff',
                                muted: '#bae6fd',
                                subtle: '#38bdf8',
                                DEFAULT: '#0ea5e9',
                                emphasis: '#0284c7',
                                inverted: '#ffffff'
                            },
                            content: {
                                strong: '#0f172a',
                                emphasis: '#334155',
                                DEFAULT: '#64748b',
                                subtle: '#94a3b8',
                                inverted: '#ffffff'
                            },
                            background: {
                                muted: '#f8fafc',
                                subtle: '#f1f5f9',
                                DEFAULT: '#ffffff'
                            }
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'ui-sans-serif', 'system-ui'],
                    },
                }
            }
        }
    </script>
    
    <style>
        .tremor-Card {
            backdrop-filter: blur(12px);
            background: rgba(255, 255, 255, 0.95);
            border-radius: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .tremor-Card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .tremor-Button {
            background: #2563eb;
            transition: all 0.2s ease;
        }
        .tremor-Button:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }
        .form-card {
            transition: all 0.3s ease;
        }
        .form-card:hover {
            transform: translateY(-4px);
        }
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .status-active {
            background-color: #dcfce7;
            color: #166534;
        }
        .status-draft {
            background-color: #fef3c7;
            color: #92400e;
        }
        .status-archived {
            background-color: #f3f4f6;
            color: #374151;
        }
    </style>
</head>
<body class="bg-gray-50">
    
    <!-- Navigation -->
    <nav class="border-b border-gray-200 bg-white/95 backdrop-blur-md fixed w-full z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="../dashboard/home.html" class="flex-shrink-0 flex items-center hover:opacity-80 transition-opacity">
                        <i class="ri-form-line text-2xl text-tremor-brand-DEFAULT mr-2"></i>
                        <span class="text-xl font-bold text-tremor-content-strong">FormEase</span>
                    </a>
                    <div class="hidden md:ml-10 md:flex md:space-x-8">
                        <a href="../dashboard/home.html" class="text-tremor-content-DEFAULT hover:text-tremor-brand-DEFAULT transition-colors">
                            Tableau de bord
                        </a>
                        <a href="management.html" class="text-tremor-brand-DEFAULT font-medium">
                            Mes formulaires
                        </a>
                        <a href="../email-tracking.html" class="text-tremor-content-DEFAULT hover:text-tremor-brand-DEFAULT transition-colors">
                            <i class="ri-mail-line mr-1"></i>Suivi Emails
                        </a>
                        <a href="sms-management.html" class="text-tremor-content-DEFAULT hover:text-tremor-brand-DEFAULT transition-colors">
                            <i class="ri-message-3-line mr-1"></i>Gestion SMS
                        </a>
                        <a href="../analytics/dashboard.html" class="text-tremor-content-DEFAULT hover:text-tremor-brand-DEFAULT transition-colors">
                            Analytics
                        </a>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <button class="p-2 text-tremor-content-DEFAULT hover:text-tremor-brand-DEFAULT">
                            <i class="ri-notification-line text-xl"></i>
                        </button>
                    </div>
                    <div class="relative">
                        <button class="flex items-center space-x-2 text-tremor-content-DEFAULT hover:text-tremor-brand-DEFAULT">
                            <div class="w-8 h-8 bg-tremor-brand-DEFAULT rounded-full flex items-center justify-center">
                                <i class="ri-user-line text-white"></i>
                            </div>
                            <span class="hidden md:block">Mon compte</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Header Section -->
    <section class="pt-20 pb-8 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
                <div>
                    <h1 class="text-3xl font-bold text-tremor-content-strong mb-2">
                        Mes Formulaires
                    </h1>
                    <p class="text-tremor-content-DEFAULT">
                        Gérez et organisez tous vos formulaires en un seul endroit
                    </p>
                </div>
                <div class="flex space-x-3 mt-4 md:mt-0">
                    <a href="../forms/ai-generator.html" class="tremor-Button inline-flex items-center px-4 py-2 rounded-lg text-white font-medium">
                        <i class="ri-magic-line mr-2"></i>
                        IA Generator
                    </a>
                    <a href="file:///C:/Users/Jeff%20KOSI/Desktop/FormEase/frontend/pages/forms/builder.html" class="bg-gray-100 hover:bg-gray-200 text-tremor-content-strong inline-flex items-center px-4 py-2 rounded-lg font-medium transition-colors">
                        <i class="ri-add-line mr-2"></i>
                        Nouveau formulaire
                    </a>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="tremor-Card p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-tremor-content-DEFAULT text-sm">Total formulaires</p>
                            <p class="text-2xl font-bold text-tremor-content-strong">12</p>
                        </div>
                        <div class="h-12 w-12 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i class="ri-file-list-line text-blue-600"></i>
                        </div>
                    </div>
                </div>
                
                <div class="tremor-Card p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-tremor-content-DEFAULT text-sm">Réponses ce mois</p>
                            <p class="text-2xl font-bold text-tremor-content-strong">2,847</p>
                        </div>
                        <div class="h-12 w-12 bg-green-100 rounded-lg flex items-center justify-center">
                            <i class="ri-chat-3-line text-green-600"></i>
                        </div>
                    </div>
                </div>
                
                <div class="tremor-Card p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-tremor-content-DEFAULT text-sm">Taux de conversion</p>
                            <p class="text-2xl font-bold text-tremor-content-strong">68%</p>
                        </div>
                        <div class="h-12 w-12 bg-purple-100 rounded-lg flex items-center justify-center">
                            <i class="ri-trending-up-line text-purple-600"></i>
                        </div>
                    </div>
                </div>
                
                <div class="tremor-Card p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-tremor-content-DEFAULT text-sm">Formulaires actifs</p>
                            <p class="text-2xl font-bold text-tremor-content-strong">8</p>
                        </div>
                        <div class="h-12 w-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                            <i class="ri-play-circle-line text-yellow-600"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Filters and Search -->
    <section class="pb-6 bg-white border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0">
                <!-- Search -->
                <div class="relative flex-1 max-w-md">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="ri-search-line text-tremor-content-subtle"></i>
                    </div>
                    <input type="text" placeholder="Rechercher un formulaire..."
                           class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-tremor-brand-DEFAULT focus:border-tremor-brand-DEFAULT">
                </div>

                <!-- Filters -->
                <div class="flex space-x-4">
                    <select class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-tremor-brand-DEFAULT focus:border-tremor-brand-DEFAULT">
                        <option>Tous les statuts</option>
                        <option>Actif</option>
                        <option>Brouillon</option>
                        <option>Archivé</option>
                    </select>
                    
                    <select class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-tremor-brand-DEFAULT focus:border-tremor-brand-DEFAULT">
                        <option>Trier par</option>
                        <option>Date de création</option>
                        <option>Dernière modification</option>
                        <option>Nombre de réponses</option>
                        <option>Nom A-Z</option>
                    </select>

                    <button class="p-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                        <i class="ri-filter-line text-tremor-content-DEFAULT"></i>
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Forms Grid -->
    <section class="py-8 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                
                <!-- Form Card 1 -->
                <div class="tremor-Card p-6 form-card">
                    <div class="flex justify-between items-start mb-4">
                        <span class="status-badge status-active">
                            <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                            Actif
                        </span>
                        <div class="relative">
                            <button class="p-1 hover:bg-gray-100 rounded" onclick="toggleDropdown('form1')">
                                <i class="ri-more-line text-tremor-content-DEFAULT"></i>
                            </button>
                            <div id="form1" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border z-10">
                                <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-50">Modifier</a>
                                <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-50">Dupliquer</a>
                                <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-50">Partager</a>
                                <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-50">Analytics</a>
                                <div class="border-t border-gray-100"></div>
                                <a href="#" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-50">Supprimer</a>
                            </div>
                        </div>
                    </div>
                    
                    <h3 class="text-lg font-semibold text-tremor-content-strong mb-2">
                        Formulaire de Contact
                    </h3>
                    <p class="text-tremor-content-DEFAULT text-sm mb-4">
                        Formulaire de contact principal pour le site web
                    </p>
                    
                    <div class="flex items-center justify-between text-sm text-tremor-content-subtle mb-4">
                        <span>Créé le 15 jan 2025</span>
                        <span>Modifié il y a 2h</span>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4 mb-4">
                        <div class="text-center">
                            <p class="text-lg font-bold text-tremor-content-strong">1,247</p>
                            <p class="text-xs text-tremor-content-subtle">Vues</p>
                        </div>
                        <div class="text-center">
                            <p class="text-lg font-bold text-tremor-content-strong">321</p>
                            <p class="text-xs text-tremor-content-subtle">Réponses</p>
                        </div>
                        <div class="text-center">
                            <p class="text-lg font-bold text-tremor-content-strong">26%</p>
                            <p class="text-xs text-tremor-content-subtle">Taux</p>
                        </div>
                    </div>
                    
                    <div class="flex space-x-2 mb-3">
                        <a href="file:///C:/Users/Jeff%20KOSI/Desktop/FormEase/frontend/pages/forms/builder.html" class="flex-1 tremor-Button text-center py-2 px-4 rounded-lg text-white text-sm">
                            Modifier
                        </a>
                        <button onclick="viewForm('form-1', 'Formulaire de Contact')" class="flex-1 bg-blue-100 hover:bg-blue-200 text-blue-700 text-center py-2 px-4 rounded-lg text-sm transition-colors">
                            Visualiser
                        </button>
                        </button>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="viewResponses('form-1', 'Formulaire de Contact', 321)" class="flex-1 bg-green-100 hover:bg-green-200 text-green-700 text-center py-2 px-3 rounded-lg text-sm transition-colors">
                            <i class="ri-file-list-line mr-1"></i>Réponses (321)
                        </button>
                        <button onclick="shareForm('form-1', 'Formulaire de Contact')" class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors" title="Partager">
                            <i class="ri-share-line text-tremor-content-DEFAULT"></i>
                        </button>
                        <button onclick="showAnalytics('form-1', 'Formulaire de Contact')" class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors" title="Analytics">
                            <i class="ri-bar-chart-line text-tremor-content-DEFAULT"></i>
                        </button>
                        <button onclick="showQRCode('form-1', 'Formulaire de Contact')" class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors" title="QR Code">
                            <i class="ri-qr-code-line text-tremor-content-DEFAULT"></i>
                        </button>
                    </div>
                </div>

                <!-- Form Card 2 -->
                <div class="tremor-Card p-6 form-card">
                    <div class="flex justify-between items-start mb-4">
                        <span class="status-badge status-draft">
                            <div class="w-2 h-2 bg-yellow-500 rounded-full mr-2"></div>
                            Brouillon
                        </span>
                        <div class="relative">
                            <button class="p-1 hover:bg-gray-100 rounded" onclick="toggleDropdown('form2')">
                                <i class="ri-more-line text-tremor-content-DEFAULT"></i>
                            </button>
                            <div id="form2" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border z-10">
                                <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-50">Modifier</a>
                                <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-50">Publier</a>
                                <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-50">Dupliquer</a>
                                <div class="border-t border-gray-100"></div>
                                <a href="#" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-50">Supprimer</a>
                            </div>
                        </div>
                    </div>
                    
                    <h3 class="text-lg font-semibold text-tremor-content-strong mb-2">
                        Sondage Satisfaction Client
                    </h3>
                    <p class="text-tremor-content-DEFAULT text-sm mb-4">
                        Évaluation de la satisfaction après achat
                    </p>
                    
                    <div class="flex items-center justify-between text-sm text-tremor-content-subtle mb-4">
                        <span>Créé le 10 jan 2025</span>
                        <span>Modifié il y a 1j</span>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4 mb-4">
                        <div class="text-center">
                            <p class="text-lg font-bold text-tremor-content-strong">-</p>
                            <p class="text-xs text-tremor-content-subtle">Vues</p>
                        </div>
                        <div class="text-center">
                            <p class="text-lg font-bold text-tremor-content-strong">-</p>
                            <p class="text-xs text-tremor-content-subtle">Réponses</p>
                        </div>
                        <div class="text-center">
                            <p class="text-lg font-bold text-tremor-content-strong">-</p>
                            <p class="text-xs text-tremor-content-subtle">Taux</p>
                        </div>
                    </div>
                    
                    <div class="flex space-x-2 mb-3">
                        <a href="file:///C:/Users/Jeff%20KOSI/Desktop/FormEase/frontend/pages/forms/builder.html" class="flex-1 tremor-Button text-center py-2 px-4 rounded-lg text-white text-sm">
                            Continuer
                        </a>
                        <button onclick="viewForm('form-2', 'Sondage Satisfaction Client')" class="flex-1 bg-blue-100 hover:bg-blue-200 text-blue-700 text-center py-2 px-4 rounded-lg text-sm transition-colors">
                            Visualiser
                        </button>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="viewResponses('form-2', 'Sondage Satisfaction Client', 0)" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-600 text-center py-2 px-3 rounded-lg text-sm transition-colors">
                            <i class="ri-file-list-line mr-1"></i>Réponses (0)
                        </button>
                        <button onclick="shareForm('form-2', 'Sondage Satisfaction Client')" class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors" title="Partager">
                            <i class="ri-share-line text-tremor-content-DEFAULT"></i>
                        </button>
                        <button onclick="showAnalytics('form-2', 'Sondage Satisfaction Client')" class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors" title="Analytics">
                            <i class="ri-bar-chart-line text-tremor-content-DEFAULT"></i>
                        </button>
                        <button onclick="showQRCode('form-2', 'Sondage Satisfaction Client')" class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors" title="QR Code">
                            <i class="ri-qr-code-line text-tremor-content-DEFAULT"></i>
                        </button>
                    </div>
                </div>

                <!-- Form Card 3 -->
                <div class="tremor-Card p-6 form-card">
                    <div class="flex justify-between items-start mb-4">
                        <span class="status-badge status-active">
                            <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                            Actif
                        </span>
                        <div class="relative">
                            <button class="p-1 hover:bg-gray-100 rounded" onclick="toggleDropdown('form3')">
                                <i class="ri-more-line text-tremor-content-DEFAULT"></i>
                            </button>
                            <div id="form3" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border z-10">
                                <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-50">Modifier</a>
                                <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-50">Dupliquer</a>
                                <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-50">Partager</a>
                                <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-50">Analytics</a>
                                <div class="border-t border-gray-100"></div>
                                <a href="#" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-50">Supprimer</a>
                            </div>
                        </div>
                    </div>
                    
                    <h3 class="text-lg font-semibold text-tremor-content-strong mb-2">
                        Inscription Événement
                    </h3>
                    <p class="text-tremor-content-DEFAULT text-sm mb-4">
                        Formulaire d'inscription pour notre prochain webinar
                    </p>
                    
                    <div class="flex items-center justify-between text-sm text-tremor-content-subtle mb-4">
                        <span>Créé le 8 jan 2025</span>
                        <span>Modifié il y a 3h</span>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4 mb-4">
                        <div class="text-center">
                            <p class="text-lg font-bold text-tremor-content-strong">856</p>
                            <p class="text-xs text-tremor-content-subtle">Vues</p>
                        </div>
                        <div class="text-center">
                            <p class="text-lg font-bold text-tremor-content-strong">127</p>
                            <p class="text-xs text-tremor-content-subtle">Réponses</p>
                        </div>
                        <div class="text-center">
                            <p class="text-lg font-bold text-tremor-content-strong">15%</p>
                            <p class="text-xs text-tremor-content-subtle">Taux</p>
                        </div>
                    </div>
                    
                    <div class="flex space-x-2 mb-3">
                        <a href="file:///C:/Users/Jeff%20KOSI/Desktop/FormEase/frontend/pages/forms/builder.html" class="flex-1 tremor-Button text-center py-2 px-4 rounded-lg text-white text-sm">
                            Modifier
                        </a>
                        <button onclick="viewForm('form-3', 'Inscription Événement')" class="flex-1 bg-blue-100 hover:bg-blue-200 text-blue-700 text-center py-2 px-4 rounded-lg text-sm transition-colors">
                            Visualiser
                        </button>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="viewResponses('form-3', 'Inscription Événement', 127)" class="flex-1 bg-green-100 hover:bg-green-200 text-green-700 text-center py-2 px-3 rounded-lg text-sm transition-colors">
                            <i class="ri-file-list-line mr-1"></i>Inscrits (127)
                        </button>
                        <button onclick="shareForm('form-3', 'Inscription Événement')" class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors" title="Partager">
                            <i class="ri-share-line text-tremor-content-DEFAULT"></i>
                        </button>
                        <button onclick="showAnalytics('form-3', 'Inscription Événement')" class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors" title="Analytics">
                            <i class="ri-bar-chart-line text-tremor-content-DEFAULT"></i>
                        </button>
                        <button onclick="showQRCode('form-3', 'Inscription Événement')" class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors" title="QR Code">
                            <i class="ri-qr-code-line text-tremor-content-DEFAULT"></i>
                        </button>
                    </div>
                </div>

                <!-- Form Card 4 -->
                <div class="tremor-Card p-6 form-card">
                    <div class="flex justify-between items-start mb-4">
                        <span class="status-badge status-archived">
                            <div class="w-2 h-2 bg-gray-500 rounded-full mr-2"></div>
                            Archivé
                        </span>
                        <div class="relative">
                            <button class="p-1 hover:bg-gray-100 rounded" onclick="toggleDropdown('form4')">
                                <i class="ri-more-line text-tremor-content-DEFAULT"></i>
                            </button>
                            <div id="form4" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border z-10">
                                <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-50">Restaurer</a>
                                <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-50">Dupliquer</a>
                                <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-50">Exporter données</a>
                                <div class="border-t border-gray-100"></div>
                                <a href="#" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-50">Supprimer définitivement</a>
                            </div>
                        </div>
                    </div>
                    
                    <h3 class="text-lg font-semibold text-tremor-content-strong mb-2">
                        Feedback Produit Q4
                    </h3>
                    <p class="text-tremor-content-DEFAULT text-sm mb-4">
                        Collecte de retours sur nos nouvelles fonctionnalités
                    </p>
                    
                    <div class="flex items-center justify-between text-sm text-tremor-content-subtle mb-4">
                        <span>Créé le 1 déc 2024</span>
                        <span>Archivé le 5 jan 2025</span>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4 mb-4">
                        <div class="text-center">
                            <p class="text-lg font-bold text-tremor-content-strong">2,154</p>
                            <p class="text-xs text-tremor-content-subtle">Vues</p>
                        </div>
                        <div class="text-center">
                            <p class="text-lg font-bold text-tremor-content-strong">573</p>
                            <p class="text-xs text-tremor-content-subtle">Réponses</p>
                        </div>
                        <div class="text-center">
                            <p class="text-lg font-bold text-tremor-content-strong">27%</p>
                            <p class="text-xs text-tremor-content-subtle">Taux</p>
                        </div>
                    </div>
                    
                    <div class="flex space-x-2">
                        <button onclick="restoreForm('form-4', 'Feedback Produit Q4')" class="flex-1 bg-gray-100 hover:bg-gray-200 text-center py-2 px-4 rounded-lg text-tremor-content-strong text-sm transition-colors">
                            Restaurer
                        </button>
                        <button onclick="exportFormData('form-4', 'Feedback Produit Q4')" class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors" title="Exporter les données">
                            <i class="ri-download-line text-tremor-content-DEFAULT"></i>
                        </button>
                        <button onclick="showQRCode('form-4', 'Feedback Produit Q4')" class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors" title="QR Code">
                            <i class="ri-qr-code-line text-tremor-content-DEFAULT"></i>
                        </button>
                    </div>
                </div>

                <!-- Empty State for more forms -->
                <div class="tremor-Card p-8 text-center border-2 border-dashed border-gray-300">
                    <div class="h-12 w-12 bg-gray-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                        <i class="ri-add-line text-2xl text-gray-400"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-tremor-content-strong mb-2">
                        Créer un nouveau formulaire
                    </h3>
                    <p class="text-tremor-content-DEFAULT text-sm mb-4">
                        Utilisez l'IA ou l'éditeur visuel pour créer votre prochain formulaire
                    </p>
                    <div class="flex flex-col space-y-2">
                        <a href="../forms/ai-generator.html" class="tremor-Button text-center py-2 px-4 rounded-lg text-white text-sm">
                            <i class="ri-magic-line mr-2"></i>
                            Avec l'IA
                        </a>
                        <a href="file:///C:/Users/Jeff%20KOSI/Desktop/FormEase/frontend/pages/forms/builder.html" class="bg-gray-100 hover:bg-gray-200 text-center py-2 px-4 rounded-lg text-tremor-content-strong text-sm transition-colors">
                            <i class="ri-edit-line mr-2"></i>
                            Manuellement
                        </a>
                    </div>
                </div>

            </div>

            <!-- Pagination -->
            <div class="flex justify-center mt-8">
                <nav class="flex space-x-2">
                    <button class="px-3 py-2 text-tremor-content-DEFAULT hover:text-tremor-brand-DEFAULT disabled:opacity-50">
                        <i class="ri-arrow-left-line"></i>
                    </button>
                    <button class="px-3 py-2 bg-tremor-brand-DEFAULT text-white rounded">1</button>
                    <button class="px-3 py-2 text-tremor-content-DEFAULT hover:text-tremor-brand-DEFAULT">2</button>
                    <button class="px-3 py-2 text-tremor-content-DEFAULT hover:text-tremor-brand-DEFAULT">3</button>
                    <button class="px-3 py-2 text-tremor-content-DEFAULT hover:text-tremor-brand-DEFAULT">
                        <i class="ri-arrow-right-line"></i>
                    </button>
                </nav>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <i class="ri-form-line text-xl text-tremor-brand-DEFAULT"></i>
                    <span class="text-tremor-content-strong font-medium">FormEase</span>
                </div>
                <div class="flex space-x-6 text-sm text-tremor-content-subtle">
                    <a href="../utils/help.html" class="hover:text-tremor-brand-DEFAULT">Aide</a>
                    <a href="../utils/api-docs.html" class="hover:text-tremor-brand-DEFAULT">API</a>
                    <a href="../public/about.html" class="hover:text-tremor-brand-DEFAULT">À propos</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Test des fonctions de base - Debug
        console.log('Script chargé correctement');
        
        // Variables globales pour le système de filtrage
        let allFormResponses = {}; // Stocke toutes les réponses par formId
        let currentFilters = {}; // Filtres actifs par formId
        let currentPage = {}; // Page actuelle par formId
        let itemsPerPage = {}; // Items par page par formId
        
        // Fonction de test
        function testFunction() {
            alert('Test fonction OK!');
        }
        
        // GESTION AVANCÉE DES RÉPONSES AVEC FILTRES ADAPTATIFS - VERSION COMPLÈTE
        function viewResponses(formId, formName, responseCount) {
            console.log('=== DÉBUT viewResponses COMPLET ===');
            console.log('Paramètres:', formId, formName, responseCount);
            
            try {
                if (responseCount === 0) {
                    showNotification(`Aucune réponse pour "${formName}"`, 'info');
                    return;
                }

                console.log('1. Vérification OK, génération des données...');
                
                // Données simulées des formulaires avec leurs champs spécifiques
                const formData = getFormDataStructure(formId);
                const responses = generateAdaptiveResponses(formId, responseCount);
                
                // Initialiser les données globales
                allFormResponses[formId] = responses;
                currentFilters[formId] = {};
                currentPage[formId] = 1;
                itemsPerPage[formId] = 25;
                
                console.log('2. Données générées et initialisées, création du modal complet...');
                
                // Modal principal avec design Tremor UI complet
                const modal = document.createElement('div');
                modal.id = 'responses-modal-' + formId;
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: rgba(0,0,0,0.5);
                    z-index: 999999;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    padding: 16px;
                    backdrop-filter: blur(4px);
                `;
                
                // Gestion des événements
                modal.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape') {
                        closeResponsesModal();
                    }
                });
                
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeResponsesModal();
                    }
                });
                
                // Bloquer le scroll du body
                document.body.style.overflow = 'hidden';
                
                modal.innerHTML = `
                    <div class="bg-white rounded-lg shadow-2xl w-full max-w-7xl h-[90vh] flex flex-col overflow-hidden">
                        <!-- Header avec gradient Tremor -->
                        <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-6 flex-shrink-0">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center">
                                        <i class="ri-file-list-3-line text-2xl"></i>
                                    </div>
                                    <div>
                                        <h2 class="text-xl font-semibold text-white">${formName}</h2>
                                        <p class="text-white/80 text-sm">${responseCount} réponses • Gestion intelligente</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <button onclick="exportResponses('${formId}', '${formName}')" 
                                            class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200">
                                        <i class="ri-download-line mr-2"></i>Exporter
                                    </button>
                                    <button onclick="closeResponsesModal()" 
                                            class="bg-white/20 hover:bg-white/30 text-white w-10 h-10 rounded-lg flex items-center justify-center transition-colors duration-200">
                                        <i class="ri-close-line text-xl"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Corps principal -->
                        <div class="flex flex-1 overflow-hidden">
                            <!-- Sidebar Filtres Adaptatifs -->
                            <div class="w-80 bg-gray-50 border-r border-gray-200 p-6 overflow-y-auto flex-shrink-0">
                                <div class="mb-6">
                                    <h3 class="text-lg font-semibold text-gray-900 mb-2">
                                        <i class="ri-filter-3-line mr-2 text-blue-600"></i>
                                        Filtres intelligents
                                    </h3>
                                    <p class="text-sm text-gray-600">Adaptés aux champs de votre formulaire</p>
                                </div>
                                
                                <div id="adaptive-filters-${formId}" class="space-y-6">
                                    ${getAdaptiveFilters(formId, formData)}
                                </div>
                                
                                <div class="mt-6 pt-6 border-t border-gray-200">
                                    <div id="filter-stats-${formId}" class="mb-4">
                                        <div class="text-sm text-gray-600">
                                            ${responseCount} résultat(s) sur ${responseCount} total
                                        </div>
                                    </div>
                                    <button onclick="resetFilters('${formId}')" 
                                            class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 py-2 px-4 rounded-lg text-sm font-medium transition-colors duration-200">
                                        <i class="ri-refresh-line mr-2"></i>Réinitialiser
                                    </button>
                                </div>
                            </div>

                            <!-- Zone de contenu principale -->
                            <div class="flex-1 flex flex-col overflow-hidden">
                                <!-- Barre de contrôles -->
                                <div class="bg-white border-b border-gray-200 p-6 flex-shrink-0">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center space-x-6">
                                            <label class="flex items-center space-x-3 cursor-pointer">
                                                <input type="checkbox" id="select-all-${formId}" 
                                                       onchange="toggleSelectAll('${formId}')"
                                                       class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2">
                                                <span class="text-sm font-medium text-gray-900">Tout sélectionner</span>
                                            </label>
                                            <span id="selection-count-${formId}" class="text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full">
                                                0 sélectionné(s)
                                            </span>
                                        </div>
                                        <div class="flex items-center space-x-4">
                                            <div class="flex items-center space-x-2">
                                                <label class="text-sm text-gray-600">Afficher:</label>
                                                <select id="per-page-${formId}" onchange="changePerPage('${formId}')"
                                                        class="bg-white border border-gray-300 rounded-lg px-3 py-1.5 text-sm text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                                    <option value="10">10 par page</option>
                                                    <option value="25" selected>25 par page</option>
                                                    <option value="50">50 par page</option>
                                                    <option value="100">100 par page</option>
                                                </select>
                                            </div>
                                            <div class="text-sm text-gray-600">
                                                <span id="total-filtered-${formId}">${responseCount}</span> réponses trouvées
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Actions en lot -->
                                    <div id="bulk-actions-${formId}" class="hidden bg-blue-50 border border-blue-200 rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="flex items-center space-x-2">
                                                <i class="ri-magic-line text-blue-600"></i>
                                                <span class="text-sm font-medium text-blue-600">Actions en lot</span>
                                                <span id="bulk-count-${formId}" class="text-xs bg-blue-600 text-white px-2 py-1 rounded-full">
                                                    0 sélectionné(s)
                                                </span>
                                            </div>
                                            <button onclick="hideBulkActions('${formId}')" class="text-gray-500 hover:text-gray-700">
                                                <i class="ri-close-line"></i>
                                            </button>
                                        </div>
                                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2">
                                            <button onclick="bulkEmail('${formId}')" 
                                                    class="flex items-center justify-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white py-2.5 px-3 rounded-lg text-xs font-medium transition-all duration-200 shadow-lg hover:shadow-xl">
                                                <i class="ri-mail-line"></i><span>Email</span>
                                            </button>
                                            <button onclick="bulkSMS('${formId}')" 
                                                    class="flex items-center justify-center space-x-2 bg-green-600 hover:bg-green-700 text-white py-2.5 px-3 rounded-lg text-xs font-medium transition-all duration-200 shadow-lg hover:shadow-xl">
                                                <i class="ri-message-line"></i><span>SMS</span>
                                            </button>
                                            <button onclick="bulkNewsletter('${formId}')" 
                                                    class="flex items-center justify-center space-x-2 bg-purple-600 hover:bg-purple-700 text-white py-2.5 px-3 rounded-lg text-xs font-medium transition-all duration-200 shadow-lg hover:shadow-xl">
                                                <i class="ri-newsletter-line"></i><span>Newsletter</span>
                                            </button>
                                            <button onclick="bulkArchive('${formId}')" 
                                                    class="flex items-center justify-center space-x-2 bg-orange-600 hover:bg-orange-700 text-white py-2.5 px-3 rounded-lg text-xs font-medium transition-all duration-200 shadow-lg hover:shadow-xl">
                                                <i class="ri-archive-line"></i><span>Archiver</span>
                                            </button>
                                            <button onclick="bulkValidate('${formId}')" 
                                                    class="flex items-center justify-center space-x-2 bg-emerald-600 hover:bg-emerald-700 text-white py-2.5 px-3 rounded-lg text-xs font-medium transition-all duration-200 shadow-lg hover:shadow-xl">
                                                <i class="ri-check-line"></i><span>Valider</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Tableau des réponses -->
                                <div class="flex-1 overflow-y-auto">
                                    <div id="responses-table-${formId}" class="p-6">
                                        ${generateAdaptiveTable(formId, formData, responses)}
                                    </div>
                                </div>
                                
                                <!-- Pagination -->
                                <div class="bg-white border-t border-gray-200 px-6 py-4 flex items-center justify-between flex-shrink-0">
                                    <div class="text-sm text-gray-600">
                                        Affichage de <span class="font-medium text-gray-900" id="page-start-${formId}">1</span> 
                                        à <span class="font-medium text-gray-900" id="page-end-${formId}">25</span> 
                                        sur <span class="font-medium text-gray-900" id="total-items-${formId}">${responseCount}</span> réponses
                                    </div>
                                    <div id="pagination-${formId}">
                                        ${generatePagination(formId, 1, Math.ceil(responseCount / 25))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                console.log('3. HTML généré, ajout au DOM...');
                document.body.appendChild(modal);
                
                console.log('4. Initialisation des filtres et événements...');
                // Initialiser les filtres et événements
                initializeAdaptiveFilters(formId);
                initializeTableEvents(formId);
                
                // Effectuer la première mise à jour du tableau pour initialiser l'affichage
                setTimeout(() => {
                    updateResponseTable(formId);
                }, 100);
                
                console.log('5. Modal de gestion des réponses initialisé avec succès!');
                
            } catch (error) {
                console.error('ERREUR dans viewResponses:', error);
                // Fallback vers modal simple en cas d'erreur
                const fallbackModal = document.createElement('div');
                fallbackModal.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
                    background: rgba(0,0,0,0.8); z-index: 999999; display: flex;
                    align-items: center; justify-content: center;
                `;
                fallbackModal.innerHTML = `
                    <div style="background: white; padding: 20px; border-radius: 8px; max-width: 500px;">
                        <h2>Erreur lors du chargement</h2>
                        <p>Erreur: ${error.message}</p>
                        <p>Formulaire: ${formName} (${responseCount} réponses)</p>
                        <button onclick="this.closest('[style*=fixed]').remove(); document.body.style.overflow='auto';">
                            Fermer
                        </button>
                    </div>
                `;
                document.body.appendChild(fallbackModal);
                document.body.style.overflow = 'hidden';
            }
            
            console.log('=== FIN viewResponses ===');
        }
        
        // FORM MANAGEMENT FUNCTIONS
        function shareForm(formId, formName) {
            try {
                console.log('shareForm appelée avec:', formId, formName);
                const shareUrl = `${window.location.origin}/form/${formId}`;
                
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(shareUrl).then(() => {
                        showNotification(`Lien du formulaire "${formName}" copié dans le presse-papier!`, 'success');
                    }).catch(() => {
                        showShareModal(shareUrl, formName);
                    });
                } else {
                    showShareModal(shareUrl, formName);
                }
            } catch (error) {
                console.error('Erreur shareForm:', error);
                showNotification(`Erreur lors du partage: ${error.message}`, 'error');
            }
        }

        function showShareModal(url, formName) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">Partager - ${formName}</h3>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="text-gray-500 hover:text-gray-700">
                            <i class="ri-close-line text-xl"></i>
                        </button>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Lien du formulaire :</label>
                        <div class="flex">
                            <input type="text" value="${url}" readonly class="flex-1 p-2 border rounded-l-lg bg-gray-50" id="shareUrl">
                            <button onclick="copyToClipboard('shareUrl')" class="px-4 py-2 bg-blue-600 text-white rounded-r-lg hover:bg-blue-700">
                                Copier
                            </button>
                        </div>
                    </div>
                    <div class="flex justify-end">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">
                            Fermer
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function copyToClipboard(inputId) {
            const input = document.getElementById(inputId);
            input.select();
            document.execCommand('copy');
            showNotification('Lien copié!', 'success');
        }

        function showAnalytics(formId, formName) {
            showNotification(`Ouverture des analytics pour "${formName}"`, 'info');
            // Simuler l'ouverture des analytics - ici vous pourriez rediriger vers une page spécifique
            setTimeout(() => {
                const analyticsModal = document.createElement('div');
                analyticsModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                analyticsModal.innerHTML = `
                    <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">Analytics - ${formName}</h3>
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" class="text-gray-500 hover:text-gray-700">
                                <i class="ri-close-line text-xl"></i>
                            </button>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="font-semibold text-blue-800">Vues totales</h4>
                                <p class="text-2xl font-bold text-blue-600">1,247</p>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h4 class="font-semibold text-green-800">Réponses</h4>
                                <p class="text-2xl font-bold text-green-600">321</p>
                            </div>
                            <div class="bg-purple-50 p-4 rounded-lg">
                                <h4 class="font-semibold text-purple-800">Taux de conversion</h4>
                                <p class="text-2xl font-bold text-purple-600">26%</p>
                            </div>
                            <div class="bg-orange-50 p-4 rounded-lg">
                                <h4 class="font-semibold text-orange-800">Temps moyen</h4>
                                <p class="text-2xl font-bold text-orange-600">3min 45s</p>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(analyticsModal);
            }, 500);
        }

        function showQRCode(formId, formName) {
            const shareUrl = `${window.location.origin}/form/${formId}`;
            
            // Créer le modal QR Code
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">QR Code - ${formName}</h3>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="text-gray-500 hover:text-gray-700">
                            <i class="ri-close-line text-xl"></i>
                        </button>
                    </div>
                    <div class="text-center">
                        <canvas id="qrcode-${formId}" class="mx-auto mb-4 border rounded-lg"></canvas>
                        <p class="text-sm text-gray-600 mb-4">Scannez ce QR code pour accéder au formulaire</p>
                        <div class="flex space-x-2">
                            <button onclick="downloadQR('${formId}', '${formName}')" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                                <i class="ri-download-line mr-2"></i>Télécharger
                            </button>
                            <button onclick="printQR('${formId}')" class="flex-1 bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">
                                <i class="ri-printer-line mr-2"></i>Imprimer
                            </button>
                        </div>
                        <div class="mt-3 pt-3 border-t">
                            <p class="text-xs text-gray-500 break-all">${shareUrl}</p>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Générer le QR code
            QRCode.toCanvas(document.getElementById(`qrcode-${formId}`), shareUrl, {
                width: 200,
                margin: 2,
                color: {
                    dark: '#000000',
                    light: '#FFFFFF'
                }
            });
        }

        function downloadQR(formId, formName) {
            const canvas = document.getElementById(`qrcode-${formId}`);
            const link = document.createElement('a');
            link.download = `qrcode-${formName.toLowerCase().replace(/\s+/g, '-')}.png`;
            link.href = canvas.toDataURL();
            link.click();
            showNotification('QR Code téléchargé!', 'success');
        }

        function printQR(formId) {
            const canvas = document.getElementById(`qrcode-${formId}`);
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>QR Code</title>
                        <style>
                            body { text-align: center; padding: 20px; font-family: Arial, sans-serif; }
                            .qr-container { margin: 20px auto; }
                            .url { font-size: 12px; color: #666; margin-top: 10px; word-break: break-all; }
                        </style>
                    </head>
                    <body>
                        <div class="qr-container">
                            <h2>QR Code - Formulaire</h2>
                            <img src="${canvas.toDataURL()}" style="border: 1px solid #ddd; border-radius: 8px;" />
                            <div class="url">Scannez pour accéder au formulaire</div>
                        </div>
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function restoreForm(formId, formName) {
            if (confirm(`Êtes-vous sûr de vouloir restaurer le formulaire "${formName}" ?`)) {
                showNotification(`Formulaire "${formName}" restauré avec succès!`, 'success');
                // Ici vous pourriez faire l'appel API pour restaurer le formulaire
                // location.reload(); // Pour rafraîchir la page après restauration
            }
        }

        function exportFormData(formId, formName) {
            showNotification(`Export des données pour "${formName}" en cours...`, 'info');
            // Simuler l'export
            setTimeout(() => {
                // Créer un fichier CSV simulé
                const csvContent = "data:text/csv;charset=utf-8,Date,Nom,Email,Message\\n2025-01-15,Jean Dupont,jean@email.com,Excellent service\\n2025-01-14,Marie Martin,marie@email.com,Très satisfaite";
                const link = document.createElement('a');
                link.href = csvContent;
                link.download = `export-${formName.toLowerCase().replace(/\s+/g, '-')}.csv`;
                link.click();
                showNotification(`Données exportées pour "${formName}"!`, 'success');
            }, 1500);
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg text-white z-50 transition-all duration-300 ${
                type === 'success' ? 'bg-green-600' : 
                type === 'error' ? 'bg-red-600' : 'bg-blue-600'
            }`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="ri-${type === 'success' ? 'check' : type === 'error' ? 'error-warning' : 'information'}-line mr-2"></i>
                    ${message}
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // VISUALISATION DU FORMULAIRE
        function viewForm(formId, formName) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="sticky top-0 bg-white border-b p-4 flex justify-between items-center">
                        <div>
                            <h3 class="text-lg font-semibold">${formName}</h3>
                            <p class="text-sm text-gray-600">Aperçu du formulaire</p>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="fillForm('${formId}', '${formName}')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                <i class="ri-edit-line mr-1"></i>Remplir
                            </button>
                            <button onclick="this.parentElement.parentElement.parentElement.parentElement.remove()" class="text-gray-500 hover:text-gray-700">
                                <i class="ri-close-line text-xl"></i>
                            </button>
                        </div>
                    </div>
                    <div class="p-6">
                        ${getFormPreview(formId)}
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function getFormPreview(formId) {
            // Simuler différents types de formulaires
            const forms = {
                'form-1': `
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Nom complet *</label>
                            <input type="text" class="w-full p-3 border rounded-lg bg-gray-50" placeholder="Votre nom et prénom" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Email *</label>
                            <input type="email" class="w-full p-3 border rounded-lg bg-gray-50" placeholder="votre@email.com" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Téléphone</label>
                            <input type="tel" class="w-full p-3 border rounded-lg bg-gray-50" placeholder="+33 1 23 45 67 89" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Sujet *</label>
                            <select class="w-full p-3 border rounded-lg bg-gray-50" disabled>
                                <option>Sélectionnez un sujet</option>
                                <option>Information produit</option>
                                <option>Support technique</option>
                                <option>Partenariat</option>
                                <option>Autre</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Message *</label>
                            <textarea class="w-full p-3 border rounded-lg bg-gray-50 h-32" placeholder="Votre message..." readonly></textarea>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" class="mr-2" disabled>
                            <label class="text-sm">J'accepte de recevoir des communications marketing</label>
                        </div>
                    </div>
                `,
                'form-2': `
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Nom *</label>
                            <input type="text" class="w-full p-3 border rounded-lg bg-gray-50" placeholder="Votre nom" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-3">Évaluez votre satisfaction globale *</label>
                            <div class="flex space-x-2">
                                ${[1,2,3,4,5].map(i => `
                                    <label class="flex flex-col items-center cursor-pointer">
                                        <input type="radio" name="satisfaction" class="mb-1" disabled>
                                        <span class="text-sm">${i === 1 ? 'Très insatisfait' : i === 5 ? 'Très satisfait' : i}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Recommanderiez-vous nos services ? *</label>
                            <div class="space-y-2">
                                <label class="flex items-center"><input type="radio" name="recommend" class="mr-2" disabled> Oui, certainement</label>
                                <label class="flex items-center"><input type="radio" name="recommend" class="mr-2" disabled> Probablement</label>
                                <label class="flex items-center"><input type="radio" name="recommend" class="mr-2" disabled> Peut-être</label>
                                <label class="flex items-center"><input type="radio" name="recommend" class="mr-2" disabled> Probablement pas</label>
                                <label class="flex items-center"><input type="radio" name="recommend" class="mr-2" disabled> Non</label>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Commentaires additionnels</label>
                            <textarea class="w-full p-3 border rounded-lg bg-gray-50 h-24" placeholder="Vos suggestions..." readonly></textarea>
                        </div>
                    </div>
                `,
                'form-3': `
                    <div class="space-y-4">
                        <div class="bg-blue-50 p-4 rounded-lg mb-4">
                            <h4 class="font-semibold text-blue-800">Webinar: Les tendances du marketing digital 2025</h4>
                            <p class="text-blue-600 text-sm">25 janvier 2025 • 14h00-16h00 • En ligne</p>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Prénom *</label>
                                <input type="text" class="w-full p-3 border rounded-lg bg-gray-50" placeholder="Votre prénom" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Nom *</label>
                                <input type="text" class="w-full p-3 border rounded-lg bg-gray-50" placeholder="Votre nom" readonly>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Email professionnel *</label>
                            <input type="email" class="w-full p-3 border rounded-lg bg-gray-50" placeholder="votre@entreprise.com" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Entreprise *</label>
                            <input type="text" class="w-full p-3 border rounded-lg bg-gray-50" placeholder="Nom de votre entreprise" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Poste/Fonction *</label>
                            <input type="text" class="w-full p-3 border rounded-lg bg-gray-50" placeholder="Votre fonction" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Secteur d'activité</label>
                            <select class="w-full p-3 border rounded-lg bg-gray-50" disabled>
                                <option>Sélectionnez votre secteur</option>
                                <option>Technologie</option>
                                <option>Marketing/Communication</option>
                                <option>E-commerce</option>
                                <option>Conseil</option>
                                <option>Autre</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Quels sujets vous intéressent le plus ?</label>
                            <div class="space-y-2">
                                <label class="flex items-center"><input type="checkbox" class="mr-2" disabled> Intelligence Artificielle</label>
                                <label class="flex items-center"><input type="checkbox" class="mr-2" disabled> Marketing automation</label>
                                <label class="flex items-center"><input type="checkbox" class="mr-2" disabled> Personnalisation</label>
                                <label class="flex items-center"><input type="checkbox" class="mr-2" disabled> Analytics avancés</label>
                            </div>
                        </div>
                    </div>
                `,
                'form-4': `
                    <div class="space-y-4">
                        <div class="bg-orange-50 p-4 rounded-lg mb-4">
                            <p class="text-orange-800 text-sm"><i class="ri-archive-line mr-1"></i>Ce formulaire est archivé</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Nom du produit évalué *</label>
                            <input type="text" class="w-full p-3 border rounded-lg bg-gray-50" placeholder="Nom du produit" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Note globale *</label>
                            <div class="flex space-x-1">
                                ${[1,2,3,4,5].map(i => `<span class="text-2xl text-gray-300">⭐</span>`).join('')}
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Qu'avez-vous le plus apprécié ?</label>
                            <textarea class="w-full p-3 border rounded-lg bg-gray-50 h-20" readonly></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Suggestions d'amélioration</label>
                            <textarea class="w-full p-3 border rounded-lg bg-gray-50 h-20" readonly></textarea>
                        </div>
                    </div>
                `
            };
            return forms[formId] || '<p class="text-center text-gray-500">Formulaire non trouvé</p>';
        }

        // REMPLISSAGE DE FORMULAIRE
        function fillForm(formId, formName) {
            // Fermer le modal de visualisation
            document.querySelector('.fixed.inset-0').remove();
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="sticky top-0 bg-white border-b p-4 flex justify-between items-center">
                        <div>
                            <h3 class="text-lg font-semibold">${formName}</h3>
                            <p class="text-sm text-gray-600">Saisie de données</p>
                        </div>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="text-gray-500 hover:text-gray-700">
                            <i class="ri-close-line text-xl"></i>
                        </button>
                    </div>
                    <form onsubmit="submitForm(event, '${formId}', '${formName}')" class="p-6">
                        ${getEditableForm(formId)}
                        <div class="flex justify-end space-x-2 mt-6 pt-4 border-t">
                            <button type="button" onclick="this.parentElement.parentElement.parentElement.parentElement.remove()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">
                                Annuler
                            </button>
                            <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                <i class="ri-send-plane-line mr-1"></i>Soumettre
                            </button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function getEditableForm(formId) {
            // Formulaires éditables (copies des aperçus mais avec inputs fonctionnels)
            const forms = {
                'form-1': `
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Nom complet *</label>
                            <input type="text" name="fullName" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Votre nom et prénom">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Email *</label>
                            <input type="email" name="email" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="votre@email.com">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Téléphone</label>
                            <input type="tel" name="phone" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="+33 1 23 45 67 89">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Sujet *</label>
                            <select name="subject" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">Sélectionnez un sujet</option>
                                <option value="product">Information produit</option>
                                <option value="support">Support technique</option>
                                <option value="partnership">Partenariat</option>
                                <option value="other">Autre</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Message *</label>
                            <textarea name="message" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Votre message..."></textarea>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" name="marketing" class="mr-2">
                            <label class="text-sm">J'accepte de recevoir des communications marketing</label>
                        </div>
                    </div>
                `,
                'form-2': `
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Nom *</label>
                            <input type="text" name="name" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Votre nom">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-3">Évaluez votre satisfaction globale *</label>
                            <div class="flex space-x-4">
                                ${[1,2,3,4,5].map(i => `
                                    <label class="flex flex-col items-center cursor-pointer">
                                        <input type="radio" name="satisfaction" value="${i}" required class="mb-1">
                                        <span class="text-sm text-center">${i === 1 ? 'Très insatisfait' : i === 5 ? 'Très satisfait' : i}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Recommanderiez-vous nos services ? *</label>
                            <div class="space-y-2">
                                <label class="flex items-center"><input type="radio" name="recommend" value="yes" required class="mr-2"> Oui, certainement</label>
                                <label class="flex items-center"><input type="radio" name="recommend" value="probably" required class="mr-2"> Probablement</label>
                                <label class="flex items-center"><input type="radio" name="recommend" value="maybe" required class="mr-2"> Peut-être</label>
                                <label class="flex items-center"><input type="radio" name="recommend" value="probably-not" required class="mr-2"> Probablement pas</label>
                                <label class="flex items-center"><input type="radio" name="recommend" value="no" required class="mr-2"> Non</label>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Commentaires additionnels</label>
                            <textarea name="comments" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 h-24" placeholder="Vos suggestions..."></textarea>
                        </div>
                    </div>
                `,
                'form-3': `
                    <div class="space-y-4">
                        <div class="bg-blue-50 p-4 rounded-lg mb-4">
                            <h4 class="font-semibold text-blue-800">Webinar: Les tendances du marketing digital 2025</h4>
                            <p class="text-blue-600 text-sm">25 janvier 2025 • 14h00-16h00 • En ligne</p>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Prénom *</label>
                                <input type="text" name="firstName" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Votre prénom">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Nom *</label>
                                <input type="text" name="lastName" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Votre nom">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Email professionnel *</label>
                            <input type="email" name="email" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="votre@entreprise.com">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Entreprise *</label>
                            <input type="text" name="company" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Nom de votre entreprise">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Poste/Fonction *</label>
                            <input type="text" name="position" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Votre fonction">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Secteur d'activité</label>
                            <select name="industry" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">Sélectionnez votre secteur</option>
                                <option value="tech">Technologie</option>
                                <option value="marketing">Marketing/Communication</option>
                                <option value="ecommerce">E-commerce</option>
                                <option value="consulting">Conseil</option>
                                <option value="other">Autre</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Quels sujets vous intéressent le plus ?</label>
                            <div class="space-y-2">
                                <label class="flex items-center"><input type="checkbox" name="interests" value="ai" class="mr-2"> Intelligence Artificielle</label>
                                <label class="flex items-center"><input type="checkbox" name="interests" value="automation" class="mr-2"> Marketing automation</label>
                                <label class="flex items-center"><input type="checkbox" name="interests" value="personalization" class="mr-2"> Personnalisation</label>
                                <label class="flex items-center"><input type="checkbox" name="interests" value="analytics" class="mr-2"> Analytics avancés</label>
                            </div>
                        </div>
                    </div>
                `,
                'form-4': `
                    <div class="space-y-4">
                        <div class="bg-orange-50 p-4 rounded-lg mb-4">
                            <p class="text-orange-800 text-sm"><i class="ri-archive-line mr-1"></i>Ce formulaire est archivé</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Nom du produit évalué *</label>
                            <input type="text" class="w-full p-3 border rounded-lg bg-gray-50" placeholder="Nom du produit" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Note globale *</label>
                            <div class="flex space-x-1">
                                ${[1,2,3,4,5].map(i => `<span class="text-2xl text-gray-300">⭐</span>`).join('')}
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Qu'avez-vous le plus apprécié ?</label>
                            <textarea class="w-full p-3 border rounded-lg bg-gray-50 h-20" readonly></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Suggestions d'amélioration</label>
                            <textarea class="w-full p-3 border rounded-lg bg-gray-50 h-20" readonly></textarea>
                        </div>
                    </div>
                `
            };
            return forms[formId] || '<p class="text-center text-gray-500">Formulaire non trouvé</p>';
        }

        // FONCTIONS DE SUPPORT POUR LE MODAL DES RÉPONSES
        
        function getFormDataStructure(formId) {
            // Structure des données selon le type de formulaire
            const formStructures = {
                'form-1': { // Formulaire de Contact
                    fields: [
                        { name: 'nom', type: 'text', label: 'Nom' },
                        { name: 'prenom', type: 'text', label: 'Prénom' },
                        { name: 'email', type: 'email', label: 'Email' },
                        { name: 'telephone', type: 'tel', label: 'Téléphone' },
                        { name: 'entreprise', type: 'text', label: 'Entreprise' },
                        { name: 'message', type: 'textarea', label: 'Message' },
                        { name: 'date_creation', type: 'datetime', label: 'Date de création' }
                    ]
                },
                'form-2': { // Sondage Satisfaction
                    fields: [
                        { name: 'satisfaction', type: 'select', label: 'Satisfaction', options: ['Très satisfait', 'Satisfait', 'Neutre', 'Insatisfait'] },
                        { name: 'recommandation', type: 'number', label: 'Note de recommandation (1-10)' },
                        { name: 'commentaires', type: 'textarea', label: 'Commentaires' },
                        { name: 'date_creation', type: 'datetime', label: 'Date de soumission' }
                    ]
                },
                'form-3': { // Inscription Événement
                    fields: [
                        { name: 'nom', type: 'text', label: 'Nom' },
                        { name: 'email', type: 'email', label: 'Email' },
                        { name: 'type_participant', type: 'select', label: 'Type', options: ['Étudiant', 'Professionnel', 'Particulier'] },
                        { name: 'regime_alimentaire', type: 'text', label: 'Régime alimentaire' },
                        { name: 'date_creation', type: 'datetime', label: 'Date d\'inscription' }
                    ]
                }
            };
            
            return formStructures[formId] || formStructures['form-1'];
        }

        function getAdaptiveFilters(formId, formData) {
            const filters = [];
            
            formData.fields.forEach(field => {
                switch(field.type) {
                    case 'text':
                    case 'email':
                        filters.push(`
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">${field.label}</label>
                                <input type="text" id="filter-${formId}-${field.name}" placeholder="Rechercher..."
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                       onkeyup="applyFilters('${formId}')" onchange="applyFilters('${formId}')">
                            </div>
                        `);
                        break;
                    case 'select':
                        const options = field.options ? field.options.map(opt => `<option value="${opt}">${opt}</option>`).join('') : '';
                        filters.push(`
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">${field.label}</label>
                                <select id="filter-${formId}-${field.name}" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                        onchange="applyFilters('${formId}')">
                                    <option value="">Tous</option>
                                    ${options}
                                </select>
                            </div>
                        `);
                        break;
                    case 'number':
                        filters.push(`
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">${field.label}</label>
                                <input type="number" id="filter-${formId}-${field.name}" placeholder="Valeur exacte..."
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                       onchange="applyFilters('${formId}')">
                            </div>
                        `);
                        break;
                    case 'datetime':
                        filters.push(`
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">Période</label>
                                <div class="space-y-2">
                                    <input type="date" id="filter-${formId}-date-from" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                           onchange="applyFilters('${formId}')" placeholder="Date début">
                                    <input type="date" id="filter-${formId}-date-to" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                           onchange="applyFilters('${formId}')" placeholder="Date fin">
                                </div>
                            </div>
                        `);
                        break;
                }
            });
            
            return filters.join('');
        }

        function generateAdaptiveResponses(formId, count) {
            const responses = [];
            const formData = getFormDataStructure(formId);
            
            for(let i = 1; i <= count; i++) {
                const response = { id: i };
                
                formData.fields.forEach(field => {
                    switch(field.name) {
                        case 'nom':
                            response[field.name] = ['Dupont', 'Martin', 'Bernard', 'Durand', 'Leroy'][Math.floor(Math.random() * 5)];
                            break;
                        case 'prenom':
                            response[field.name] = ['Jean', 'Marie', 'Pierre', 'Sophie', 'Paul'][Math.floor(Math.random() * 5)];
                            break;
                        case 'email':
                            response[field.name] = `${response.prenom || 'user'}${i}@example.com`.toLowerCase();
                            break;
                        case 'telephone':
                            response[field.name] = `+33 ${Math.floor(Math.random() * 9 + 1)} ${Math.floor(Math.random() * 90 + 10)} ${Math.floor(Math.random() * 90 + 10)} ${Math.floor(Math.random() * 90 + 10)}`;
                            break;
                        case 'entreprise':
                            response[field.name] = ['TechCorp', 'InnovateLab', 'StartupXYZ', 'GlobalTech', 'LocalBiz'][Math.floor(Math.random() * 5)];
                            break;
                        case 'message':
                            response[field.name] = 'Message de test pour la démonstration...';
                            break;
                        case 'satisfaction':
                            response[field.name] = ['Très satisfait', 'Satisfait', 'Neutre', 'Insatisfait'][Math.floor(Math.random() * 4)];
                            break;
                        case 'recommandation':
                            response[field.name] = Math.floor(Math.random() * 10) + 1;
                            break;
                        case 'commentaires':
                            response[field.name] = 'Commentaire de test...';
                            break;
                        case 'type_participant':
                            response[field.name] = ['Étudiant', 'Professionnel', 'Particulier'][Math.floor(Math.random() * 3)];
                            break;
                        case 'regime_alimentaire':
                            response[field.name] = ['Aucun', 'Végétarien', 'Végan', 'Sans gluten'][Math.floor(Math.random() * 4)];
                            break;
                        case 'date_creation':
                            const date = new Date();
                            date.setDate(date.getDate() - Math.floor(Math.random() * 30));
                            response[field.name] = date.toLocaleDateString('fr-FR') + ' ' + date.toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'});
                            break;
                        default:
                            response[field.name] = `Valeur ${i}`;
                    }
                });
                
                responses.push(response);
            }
            
            return responses;
        }

        function generateAdaptiveTable(formId, formData, responses) {
            if (!responses.length) return '<p class="text-center text-gray-500 py-8">Aucune réponse trouvée</p>';
            
            const headers = formData.fields.map(field => 
                `<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">${field.label}</th>`
            ).join('');
            
            const rows = responses.slice(0, 25).map(response => {
                const cells = formData.fields.map(field => {
                    let value = response[field.name] || '';
                    if (field.type === 'textarea' && value.length > 50) {
                        value = value.substring(0, 50) + '...';
                    }
                    return `<td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">${value}</td>`;
                }).join('');
                
                return `
                    <tr class="hover:bg-gray-50 border-b border-gray-200">
                        <td class="px-4 py-4 whitespace-nowrap">
                            <input type="checkbox" class="response-checkbox w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                                   onchange="updateSelectionCount('${formId}')">
                        </td>
                        ${cells}
                        <td class="px-4 py-4 whitespace-nowrap text-sm">
                            <span class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">En attente</span>
                        </td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">
                            <button class="text-blue-600 hover:text-blue-900 mr-2" title="Voir détails">
                                <i class="ri-eye-line"></i>
                            </button>
                            <button class="text-green-600 hover:text-green-900 mr-2" title="Éditer">
                                <i class="ri-edit-line"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
            
            return `
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left">
                                    <input type="checkbox" class="w-4 h-4 text-blue-600" id="select-all-table-${formId}" onchange="toggleSelectAllTable('${formId}')">
                                </th>
                                ${headers}
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Statut</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            ${rows}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function generatePagination(formId, currentPage, totalPages) {
            if (totalPages <= 1) return '';
            
            let pagination = '';
            
            // Bouton précédent
            pagination += `
                <button onclick="changePage('${formId}', ${currentPage - 1})" 
                        ${currentPage <= 1 ? 'disabled' : ''} 
                        class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-l-md hover:bg-gray-50 ${currentPage <= 1 ? 'opacity-50 cursor-not-allowed' : ''}">
                    Précédent
                </button>
            `;
            
            // Numéros de pages
            for(let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) {
                pagination += `
                    <button onclick="changePage('${formId}', ${i})" 
                            class="px-3 py-2 text-sm font-medium ${i === currentPage ? 'text-blue-600 bg-blue-50 border-blue-500' : 'text-gray-500 bg-white border-gray-300 hover:bg-gray-50'} border-t border-b">
                        ${i}
                    </button>
                `;
            }
            
            // Bouton suivant
            pagination += `
                <button onclick="changePage('${formId}', ${currentPage + 1})" 
                        ${currentPage >= totalPages ? 'disabled' : ''} 
                        class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-r-md hover:bg-gray-50 ${currentPage >= totalPages ? 'opacity-50 cursor-not-allowed' : ''}">
                    Suivant
                </button>
            `;
            
            return `<div class="flex">${pagination}</div>`;
        }

        // FONCTIONS D'INTERACTION POUR LE MODAL
        
        function initializeAdaptiveFilters(formId) {
            console.log('Initialisation des filtres pour', formId);
            // Les filtres sont déjà initialisés via les événements onkeyup/onchange
        }

        function initializeTableEvents(formId) {
            console.log('Initialisation des événements du tableau pour', formId);
            // Les événements sont déjà attachés via les attributs onclick
        }

        function applyFilters(formId) {
            console.log('Application des filtres pour', formId);
            
            // Récupérer tous les filtres actifs
            const filters = {};
            const filterElements = document.querySelectorAll(`#adaptive-filters-${formId} input, #adaptive-filters-${formId} select`);
            
            filterElements.forEach(element => {
                if (element.value && element.value.trim() !== '') {
                    const fieldName = element.id.replace(`filter-${formId}-`, '');
                    filters[fieldName] = {
                        value: element.value.trim(),
                        type: element.type || 'text'
                    };
                }
            });
            
            // Récupérer les filtres de date
            const dateFromInput = document.getElementById(`filter-${formId}-date-from`);
            const dateToInput = document.getElementById(`filter-${formId}-date-to`);
            
            if (dateFromInput && dateFromInput.value) {
                filters['date_from'] = {
                    value: dateFromInput.value,
                    type: 'date-from'
                };
            }
            
            if (dateToInput && dateToInput.value) {
                filters['date_to'] = {
                    value: dateToInput.value,
                    type: 'date-to'
                };
            }
            
            currentFilters[formId] = filters;
            currentPage[formId] = 1; // Reset à la première page
            
            console.log('Filtres appliqués:', filters);
            
            // Appliquer les filtres et mettre à jour l'affichage
            updateResponseTable(formId);
            
            showNotification(`Filtres appliqués - ${Object.keys(filters).length} filtre(s) actif(s)`, 'success');
        }

        function resetFilters(formId) {
            console.log('Réinitialisation des filtres pour', formId);
            
            // Réinitialiser tous les champs de filtre
            const filters = document.querySelectorAll(`#adaptive-filters-${formId} input, #adaptive-filters-${formId} select`);
            filters.forEach(filter => {
                filter.value = '';
            });
            
            // Réinitialiser les filtres globaux
            currentFilters[formId] = {};
            currentPage[formId] = 1;
            
            // Mettre à jour l'affichage
            updateResponseTable(formId);
            
            showNotification('Filtres réinitialisés', 'info');
        }

        // Nouvelle fonction pour appliquer les filtres aux données
        function filterResponses(formId, responses) {
            const filters = currentFilters[formId] || {};
            
            if (Object.keys(filters).length === 0) {
                return responses; // Aucun filtre, retourner toutes les réponses
            }
            
            return responses.filter(response => {
                for (const [fieldName, filter] of Object.entries(filters)) {
                    const fieldValue = response[fieldName];
                    
                    if (!fieldValue) continue;
                    
                    switch (filter.type) {
                        case 'text':
                        case 'email':
                            // Recherche insensible à la casse
                            if (!fieldValue.toString().toLowerCase().includes(filter.value.toLowerCase())) {
                                return false;
                            }
                            break;
                            
                        case 'select':
                            // Correspondance exacte pour les sélections
                            if (fieldValue !== filter.value) {
                                return false;
                            }
                            break;
                            
                        case 'number':
                            // Correspondance numérique
                            if (parseInt(fieldValue) !== parseInt(filter.value)) {
                                return false;
                            }
                            break;
                            
                        case 'date-from':
                            // Filtrer par date de début
                            const responseDate = new Date(fieldValue.split(' ')[0].split('/').reverse().join('-'));
                            const fromDate = new Date(filter.value);
                            if (responseDate < fromDate) {
                                return false;
                            }
                            break;
                            
                        case 'date-to':
                            // Filtrer par date de fin
                            const responseDateTo = new Date(fieldValue.split(' ')[0].split('/').reverse().join('-'));
                            const toDate = new Date(filter.value);
                            if (responseDateTo > toDate) {
                                return false;
                            }
                            break;
                    }
                }
                
                return true; // La réponse passe tous les filtres
            });
        }

        // Nouvelle fonction pour mettre à jour le tableau avec les filtres
        function updateResponseTable(formId) {
            const allResponses = allFormResponses[formId] || [];
            const formData = getFormDataStructure(formId);
            
            // Appliquer les filtres
            const filteredResponses = filterResponses(formId, allResponses);
            
            // Calculer la pagination
            const totalItems = filteredResponses.length;
            const perPage = itemsPerPage[formId] || 25;
            const totalPages = Math.ceil(totalItems / perPage);
            const currentPageNum = currentPage[formId] || 1;
            
            // Obtenir les réponses pour la page actuelle
            const startIndex = (currentPageNum - 1) * perPage;
            const endIndex = startIndex + perPage;
            const pageResponses = filteredResponses.slice(startIndex, endIndex);
            
            // Mettre à jour le tableau
            const tableContainer = document.getElementById(`responses-table-${formId}`);
            if (tableContainer) {
                tableContainer.innerHTML = generateAdaptiveTable(formId, formData, pageResponses);
            }
            
            // Mettre à jour la pagination
            const paginationContainer = document.getElementById(`pagination-${formId}`);
            if (paginationContainer) {
                paginationContainer.innerHTML = generatePagination(formId, currentPageNum, totalPages);
            }
            
            // Mettre à jour les statistiques
            const statsElement = document.getElementById(`filter-stats-${formId}`);
            if (statsElement) {
                const activeFilters = Object.keys(currentFilters[formId] || {}).length;
                statsElement.innerHTML = `
                    <div class="text-sm text-gray-600">
                        ${filteredResponses.length} résultat(s) sur ${allResponses.length} total
                        ${activeFilters > 0 ? `• ${activeFilters} filtre(s) actif(s)` : ''}
                    </div>
                `;
            }
        }

        function updateSelectionCount(formId) {
            const checkboxes = document.querySelectorAll('.response-checkbox:checked');
            const count = checkboxes.length;
            const countElement = document.getElementById(`selection-count-${formId}`);
            const bulkActions = document.getElementById(`bulk-actions-${formId}`);
            const bulkCount = document.getElementById(`bulk-count-${formId}`);
            
            if (countElement) {
                countElement.textContent = `${count} sélectionné(s)`;
            }
            
            if (bulkActions) {
                bulkActions.style.display = count > 0 ? 'block' : 'none';
            }
            
            if (bulkCount) {
                bulkCount.textContent = `${count} sélectionné(s)`;
            }
        }

        function toggleSelectAll(formId) {
            const selectAll = document.getElementById(`select-all-${formId}`);
            const checkboxes = document.querySelectorAll('.response-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
            
            updateSelectionCount(formId);
        }

        function toggleSelectAllTable(formId) {
            const selectAll = document.getElementById(`select-all-table-${formId}`);
            const checkboxes = document.querySelectorAll('.response-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
            
            updateSelectionCount(formId);
        }

        function changePage(formId, page) {
            console.log(`Changement de page: ${page} pour ${formId}`);
            currentPage[formId] = page;
            updateResponseTable(formId);
            showNotification(`Page ${page} chargée`, 'info');
        }

        function changePerPage(formId) {
            const select = document.getElementById(`per-page-${formId}`);
            if (select && select.value) {
                itemsPerPage[formId] = parseInt(select.value);
                currentPage[formId] = 1; // Reset à la première page
                updateResponseTable(formId);
                console.log(`Changement d'affichage: ${select.value} par page pour ${formId}`);
                showNotification(`Affichage ${select.value} par page`, 'info');
            }
        }

        function hideBulkActions(formId) {
            const bulkActions = document.getElementById(`bulk-actions-${formId}`);
            if (bulkActions) {
                bulkActions.style.display = 'none';
            }
            // Décocher toutes les cases
            const checkboxes = document.querySelectorAll('.response-checkbox');
            checkboxes.forEach(checkbox => checkbox.checked = false);
            updateSelectionCount(formId);
        }

        function exportResponses(formId, formName) {
            console.log(`Export des réponses pour ${formName} (${formId})`);
            showNotification(`Export de "${formName}" en cours...`, 'info');
            
            // Simulation de l'export
            setTimeout(() => {
                showNotification(`Export de "${formName}" terminé`, 'success');
            }, 2000);
        }

        // Dropdown toggle functionality
        function toggleDropdown(id) {
            const dropdown = document.getElementById(id);
            const allDropdowns = document.querySelectorAll('[id^="form"]');
            
            // Close all other dropdowns
            allDropdowns.forEach(dd => {
                if (dd.id !== id) {
                    dd.classList.add('hidden');
                }
            });
            
            // Toggle current dropdown
            dropdown.classList.toggle('hidden');
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('[onclick^="toggleDropdown"]')) {
                const allDropdowns = document.querySelectorAll('[id^="form"]');
                allDropdowns.forEach(dd => dd.classList.add('hidden'));
            }
        });

        // Navbar background on scroll
        window.addEventListener('scroll', function() {
            const nav = document.querySelector('nav');
            if (window.scrollY > 100) {
                nav.classList.add('bg-white', 'shadow-md');
                nav.classList.remove('bg-white/95');
            } else {
                nav.classList.remove('bg-white', 'shadow-md');
                nav.classList.add('bg-white/95');
            }
        });

        // FONCTIONS D'ACTIONS EN LOT POUR LE MODAL DES RÉPONSES
        
        function getSelectedResponses() {
            return document.querySelectorAll('.response-checkbox:checked');
        }

        function bulkEmail(formId) {
            const selected = getSelectedResponses();
            if (selected.length === 0) {
                showNotification('Aucune réponse sélectionnée', 'warning');
                return;
            }

            // Créer le modal d'envoi d'email
            const emailModal = document.createElement('div');
            emailModal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4';
            emailModal.style.zIndex = '9999999'; // Z-index encore plus élevé que le modal principal
            emailModal.innerHTML = `
                <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                    <div class="bg-blue-600 text-white p-6 rounded-t-lg">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold flex items-center">
                                <i class="ri-mail-line mr-2"></i>
                                Envoi d'email groupé
                            </h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-white/80 hover:text-white">
                                <i class="ri-close-line text-xl"></i>
                            </button>
                        </div>
                        <p class="text-white/80 mt-2">${selected.length} destinataire(s) sélectionné(s)</p>
                    </div>
                    
                    <div class="p-6 space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Objet de l'email *</label>
                            <input type="text" id="email-subject-${formId}" placeholder="Entrez l'objet de votre email..." 
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Message *</label>
                            <textarea id="email-message-${formId}" rows="6" placeholder="Rédigez votre message..."
                                      class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none"></textarea>
                        </div>
                        
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="text-sm font-medium text-gray-900 mb-2">Variables disponibles :</h4>
                            <div class="grid grid-cols-2 gap-2 text-xs text-gray-600">
                                <span class="bg-white px-2 py-1 rounded border">{{nom}}</span>
                                <span class="bg-white px-2 py-1 rounded border">{{email}}</span>
                                <span class="bg-white px-2 py-1 rounded border">{{entreprise}}</span>
                                <span class="bg-white px-2 py-1 rounded border">{{date}}</span>
                            </div>
                        </div>
                        
                        <div class="flex items-center space-x-3">
                            <input type="checkbox" id="email-template-${formId}" class="w-4 h-4 text-blue-600">
                            <label for="email-template-${formId}" class="text-sm text-gray-700">Sauvegarder comme modèle</label>
                        </div>
                        
                        <div class="flex space-x-3 pt-4">
                            <button onclick="sendBulkEmail('${formId}')" 
                                    class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg font-medium transition-colors duration-200">
                                <i class="ri-send-plane-line mr-2"></i>Envoyer
                            </button>
                            <button onclick="this.closest('.fixed').remove()" 
                                    class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200">
                                Annuler
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(emailModal);
        }

        function bulkSMS(formId) {
            const selected = getSelectedResponses();
            if (selected.length === 0) {
                showNotification('Aucune réponse sélectionnée', 'warning');
                return;
            }

            const smsModal = document.createElement('div');
            smsModal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4';
            smsModal.style.zIndex = '9999999';
            smsModal.innerHTML = `
                <div class="bg-white rounded-lg shadow-2xl max-w-lg w-full">
                    <div class="bg-green-600 text-white p-6 rounded-t-lg">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold flex items-center">
                                <i class="ri-message-line mr-2"></i>
                                Envoi de SMS groupé
                            </h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-white/80 hover:text-white">
                                <i class="ri-close-line text-xl"></i>
                            </button>
                        </div>
                        <p class="text-white/80 mt-2">${selected.length} destinataire(s) sélectionné(s)</p>
                    </div>
                    
                    <div class="p-6 space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Message SMS *</label>
                            <textarea id="sms-message-${formId}" rows="4" maxlength="160" placeholder="Rédigez votre SMS (max 160 caractères)..."
                                      class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 resize-none"
                                      oninput="updateSMSCounter('${formId}')"></textarea>
                            <div class="flex justify-between items-center mt-2">
                                <span class="text-xs text-gray-500">Variables: {{nom}}, {{prenom}}</span>
                                <span id="sms-counter-${formId}" class="text-xs text-gray-500">0/160</span>
                            </div>
                        </div>
                        
                        <div class="bg-yellow-50 border border-yellow-200 p-3 rounded-lg">
                            <div class="flex items-start space-x-2">
                                <i class="ri-information-line text-yellow-600 mt-0.5"></i>
                                <div class="text-sm text-yellow-800">
                                    <p class="font-medium">Coût estimé</p>
                                    <p>€${(selected.length * 0.05).toFixed(2)} (${selected.length} SMS × €0.05)</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="sendBulkSMS('${formId}')" 
                                    class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-lg font-medium transition-colors duration-200">
                                <i class="ri-send-plane-line mr-2"></i>Envoyer SMS
                            </button>
                            <button onclick="this.closest('.fixed').remove()" 
                                    class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200">
                                Annuler
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(smsModal);
        }

        function bulkNewsletter(formId) {
            const selected = getSelectedResponses();
            if (selected.length === 0) {
                showNotification('Aucune réponse sélectionnée', 'warning');
                return;
            }

            const newsletterModal = document.createElement('div');
            newsletterModal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4';
            newsletterModal.style.zIndex = '9999999';
            newsletterModal.innerHTML = `
                <div class="bg-white rounded-lg shadow-2xl max-w-lg w-full">
                    <div class="bg-purple-600 text-white p-6 rounded-t-lg">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold flex items-center">
                                <i class="ri-newsletter-line mr-2"></i>
                                Ajout à la newsletter
                            </h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-white/80 hover:text-white">
                                <i class="ri-close-line text-xl"></i>
                            </button>
                        </div>
                        <p class="text-white/80 mt-2">${selected.length} contact(s) à ajouter</p>
                    </div>
                    
                    <div class="p-6 space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Newsletter *</label>
                            <select id="newsletter-select-${formId}" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" onchange="toggleNewNewsletterSection('${formId}')">
                                <option value="main">Newsletter Principale</option>
                                <option value="promo">Promotions & Offres</option>
                                <option value="tech">Actualités Techniques</option>
                                <option value="new" selected>Créer une nouvelle newsletter</option>
                            </select>
                        </div>
                        
                        <div id="new-newsletter-section-${formId}" class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">Nom de la nouvelle newsletter *</label>
                                <input type="text" id="newsletter-name-${formId}" placeholder="Ex: Contacts FormEase 2025" 
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">Description</label>
                                <textarea id="newsletter-description-${formId}" rows="2" placeholder="Description de la newsletter..."
                                          class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none"></textarea>
                            </div>
                        </div>
                        
                        <div class="bg-purple-50 border border-purple-200 p-3 rounded-lg">
                            <div class="flex items-center space-x-2">
                                <input type="checkbox" id="newsletter-welcome-${formId}" class="w-4 h-4 text-purple-500" checked>
                                <label for="newsletter-welcome-${formId}" class="text-sm text-purple-800">Envoyer un email de bienvenue</label>
                            </div>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="addToNewsletter('${formId}')" 
                                    class="flex-1 bg-purple-600 hover:bg-purple-700 text-white py-3 px-4 rounded-lg font-medium transition-colors duration-200">
                                <i class="ri-add-line mr-2"></i>Ajouter
                            </button>
                            <button onclick="this.closest('.fixed').remove()" 
                                    class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200">
                                Annuler
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(newsletterModal);
        }

        function bulkArchive(formId) {
            const selected = getSelectedResponses();
            if (selected.length === 0) {
                showNotification('Aucune réponse sélectionnée', 'warning');
                return;
            }

            if (confirm(`Êtes-vous sûr de vouloir archiver ${selected.length} réponse(s) ?\n\nLes réponses archivées ne seront plus visibles dans la vue principale.`)) {
                showNotification(`Archivage de ${selected.length} réponse(s) en cours...`, 'info');
                
                setTimeout(() => {
                    selected.forEach(checkbox => {
                        const row = checkbox.closest('tr');
                        if (row) {
                            row.style.transition = 'opacity 0.5s ease';
                            row.style.opacity = '0.5';
                            
                            const statusCell = row.querySelector('td:nth-last-child(2)');
                            if (statusCell) {
                                statusCell.innerHTML = '<span class="px-2 py-1 text-xs font-medium rounded-full bg-orange-100 text-orange-800">Archivé</span>';
                            }
                        }
                        checkbox.checked = false;
                    });
                    
                    updateSelectionCount(formId);
                    showNotification(`${selected.length} réponse(s) archivée(s) avec succès`, 'success');
                }, 1000);
            }
        }

        function bulkValidate(formId) {
            const selected = getSelectedResponses();
            if (selected.length === 0) {
                showNotification('Aucune réponse sélectionnée', 'warning');
                return;
            }

            const validationModal = document.createElement('div');
            validationModal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4';
            validationModal.style.zIndex = '9999999';
            validationModal.innerHTML = `
                <div class="bg-white rounded-lg shadow-2xl max-w-md w-full">
                    <div class="bg-emerald-600 text-white p-6 rounded-t-lg">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold flex items-center">
                                <i class="ri-check-line mr-2"></i>
                                Validation des réponses
                            </h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-white/80 hover:text-white">
                                <i class="ri-close-line text-xl"></i>
                            </button>
                        </div>
                        <p class="text-white/80 mt-2">${selected.length} réponse(s) à valider</p>
                    </div>
                    
                    <div class="p-6 space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Statut de validation *</label>
                            <select id="validation-status-${formId}" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
                                <option value="validated">Validé</option>
                                <option value="approved">Approuvé</option>
                                <option value="verified">Vérifié</option>
                                <option value="completed">Traité</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2">Note de validation (optionnel)</label>
                            <textarea id="validation-note-${formId}" rows="3" placeholder="Ajoutez une note de validation..."
                                      class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 resize-none"></textarea>
                        </div>
                        
                        <div class="bg-emerald-50 border border-emerald-200 p-3 rounded-lg">
                            <div class="flex items-center space-x-2">
                                <input type="checkbox" id="notify-validation-${formId}" class="w-4 h-4 text-emerald-500" checked>
                                <label for="notify-validation-${formId}" class="text-sm text-emerald-800">Notifier les contacts par email</label>
                            </div>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="validateResponses('${formId}')" 
                                    class="flex-1 bg-emerald-600 hover:bg-emerald-700 text-white py-3 px-4 rounded-lg font-medium transition-colors duration-200">
                                <i class="ri-check-double-line mr-2"></i>Valider
                            </button>
                            <button onclick="this.closest('.fixed').remove()" 
                                    class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200">
                                Annuler
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(validationModal);
        }

        // FONCTIONS DE SUPPORT POUR LES ACTIONS EN LOT
        
        function sendBulkEmail(formId) {
            const subject = document.getElementById(`email-subject-${formId}`).value;
            const message = document.getElementById(`email-message-${formId}`).value;
            const saveTemplate = document.getElementById(`email-template-${formId}`).checked;
            
            if (!subject.trim() || !message.trim()) {
                showNotification('Veuillez remplir l\'objet et le message', 'warning');
                return;
            }
            
            const selected = getSelectedResponses();
            
            showNotification('Envoi des emails en cours...', 'info');
            document.querySelector('[style*="z-index: 9999999"]').remove();
            
            setTimeout(() => {
                if (saveTemplate) {
                    showNotification(`Emails envoyés à ${selected.length} destinataires et modèle sauvegardé`, 'success');
                } else {
                    showNotification(`Emails envoyés avec succès à ${selected.length} destinataires`, 'success');
                }
                
                selected.forEach(checkbox => checkbox.checked = false);
                updateSelectionCount(formId);
            }, 2000);
        }

        function sendBulkSMS(formId) {
            const message = document.getElementById(`sms-message-${formId}`).value;
            
            if (!message.trim()) {
                showNotification('Veuillez saisir un message', 'warning');
                return;
            }
            
            if (message.length > 160) {
                showNotification('Le message dépasse 160 caractères', 'warning');
                return;
            }
            
            const selected = getSelectedResponses();
            if (selected.length === 0) {
                showNotification('Aucun destinataire sélectionné', 'warning');
                return;
            }
            
            // Extraire les numéros de téléphone des réponses sélectionnées
            const recipients = [];
            selected.forEach(checkbox => {
                const row = checkbox.closest('tr');
                if (row) {
                    // Chercher le numéro de téléphone dans la ligne (adapter selon la structure des données)
                    const cells = row.querySelectorAll('td');
                    // Supposons que le téléphone est dans la 4ème colonne (index 3)
                    const phoneCell = cells[3];
                    if (phoneCell && phoneCell.textContent.trim()) {
                        const phone = phoneCell.textContent.trim();
                        if (phone && phone !== '-' && phone.length > 0) {
                            recipients.push(phone);
                        }
                    }
                }
            });
            
            if (recipients.length === 0) {
                showNotification('Aucun numéro de téléphone valide trouvé dans la sélection', 'warning');
                return;
            }
            
            // Fermer le modal de SMS
            const smsModal = document.querySelector('[style*="z-index: 9999999"]');
            if (smsModal) smsModal.remove();
            
            showNotification(`Envoi de SMS vers ${recipients.length} destinataire(s)...`, 'info');
            
            // Appel API pour envoyer les SMS en lot
            fetch('http://localhost:4000/api/sms/bulk', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    // Pour les tests, utilisons un token de démonstration ou simulons sans API
                    'Authorization': `Bearer ${localStorage.getItem('formease_token') || 'demo-token'}`
                },
                body: JSON.stringify({
                    recipients: recipients,
                    message: message,
                    provider: 'twilio' // Provider par défaut
                })
            })
            .then(response => {
                if (!response.ok) {
                    // Si l'authentification échoue, simuler un succès pour les tests
                    if (response.status === 401 || response.status === 403) {
                        console.log('Mode démonstration SMS activé');
                        return { 
                            success: true, 
                            successCount: recipients.length, 
                            failedCount: 0,
                            demoMode: true 
                        };
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    const successCount = data.successCount || recipients.length;
                    const failedCount = data.failedCount || 0;
                    
                    if (data.demoMode) {
                        showNotification(`SMS simul�s avec succès à ${successCount} destinataire(s) (Mode Demo)`, 'success');
                    } else if (failedCount > 0) {
                        showNotification(`SMS envoyés: ${successCount} succès, ${failedCount} échecs`, 'warning');
                    } else {
                        showNotification(`SMS envoyés avec succès à ${successCount} destinataire(s)`, 'success');
                    }
                } else {
                    showNotification(`Erreur lors de l'envoi: ${data.message || 'Erreur inconnue'}`, 'error');
                }
                
                // Décocher les cases sélectionnées
                selected.forEach(checkbox => checkbox.checked = false);
                updateSelectionCount(formId);
            })
            .catch(error => {
                console.error('Erreur SMS:', error);
                showNotification('Erreur de connexion lors de l\'envoi des SMS', 'error');
                
                // Décocher les cases en cas d'erreur aussi
                selected.forEach(checkbox => checkbox.checked = false);
                updateSelectionCount(formId);
            });
        }

        function updateSMSCounter(formId) {
            const textarea = document.getElementById(`sms-message-${formId}`);
            const counter = document.getElementById(`sms-counter-${formId}`);
            if (textarea && counter) {
                const length = textarea.value.length;
                counter.textContent = `${length}/160`;
                counter.className = length > 160 ? 'text-xs text-red-500' : 'text-xs text-gray-500';
            }
        }

        function addToNewsletter(formId) {
            const newsletterSelect = document.getElementById(`newsletter-select-${formId}`).value;
            const newsletterName = document.getElementById(`newsletter-name-${formId}`)?.value;
            const sendWelcome = document.getElementById(`newsletter-welcome-${formId}`).checked;
            
            if (newsletterSelect === 'new' && !newsletterName?.trim()) {
                showNotification('Veuillez saisir le nom de la nouvelle newsletter', 'warning');
                return;
            }
            
            const selected = getSelectedResponses();
            
            showNotification('Ajout à la newsletter en cours...', 'info');
            document.querySelector('[style*="z-index: 9999999"]').remove();
            
            setTimeout(() => {
                if (newsletterSelect === 'new') {
                    showNotification(`${selected.length} contacts ajoutés à la nouvelle newsletter "${newsletterName}"`, 'success');
                } else {
                    const newsletterNames = {
                        'main': 'Newsletter Principale',
                        'promo': 'Promotions & Offres',
                        'tech': 'Actualités Techniques'
                    };
                    showNotification(`${selected.length} contacts ajoutés à "${newsletterNames[newsletterSelect]}"`, 'success');
                }
                
                if (sendWelcome) {
                    setTimeout(() => {
                        showNotification('Emails de bienvenue envoyés', 'success');
                    }, 1000);
                }
                
                selected.forEach(checkbox => checkbox.checked = false);
                updateSelectionCount(formId);
            }, 1500);
        }

        function toggleNewNewsletterSection(formId) {
            const select = document.getElementById(`newsletter-select-${formId}`);
            const section = document.getElementById(`new-newsletter-section-${formId}`);
            
            if (select && section) {
                section.style.display = select.value === 'new' ? 'block' : 'none';
            }
        }

        function validateResponses(formId) {
            const status = document.getElementById(`validation-status-${formId}`).value;
            const note = document.getElementById(`validation-note-${formId}`)?.value;
            const notify = document.getElementById(`notify-validation-${formId}`).checked;
            
            const selected = getSelectedResponses();
            
            showNotification('Validation des réponses en cours...', 'info');
            document.querySelector('[style*="z-index: 9999999"]').remove();
            
            setTimeout(() => {
                selected.forEach(checkbox => {
                    const row = checkbox.closest('tr');
                    if (row) {
                        const statusCell = row.querySelector('td:nth-last-child(2)');
                        if (statusCell) {
                            const statusLabels = {
                                'validated': 'Validé',
                                'approved': 'Approuvé', 
                                'verified': 'Vérifié',
                                'completed': 'Traité'
                            };
                            statusCell.innerHTML = `<span class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">${statusLabels[status]}</span>`;
                        }
                    }
                    checkbox.checked = false;
                });
                
                updateSelectionCount(formId);
                showNotification(`${selected.length} réponse(s) validée(s) avec succès`, 'success');
                
                if (notify) {
                    setTimeout(() => {
                        showNotification('Notifications envoyées aux contacts', 'success');
                    }, 1000);
                }
            }, 1500);
        }

    </script>
</body>
</html>
