<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FormEase - Tableau de Bord Avancé</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.0.0/fonts/remixicon.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../styles/tremor-base.css">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        tremor: {
                            brand: {
                                faint: '#f0f9ff',
                                muted: '#bae6fd',
                                subtle: '#38bdf8',
                                DEFAULT: '#0ea5e9',
                                emphasis: '#0284c7',
                                inverted: '#ffffff'
                            }
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'ui-sans-serif', 'system-ui'],
                    },
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Layout principal en grid avec container élargi -->
    <div class="min-h-screen max-w-[1400px] mx-auto grid grid-cols-1 lg:grid-cols-[260px_1fr] gap-7 p-4 md:p-6 lg:p-8">
        <!-- Navigation Sidebar -->
        <aside class="bg-white rounded-lg shadow-sm border border-gray-200 h-fit">
            <!-- Logo -->
            <div class="flex items-center px-4 py-4 border-b border-gray-200">
                <div class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center">
                    <i class="ri-file-list-3-line text-white text-lg"></i>
                </div>
                <span class="ml-3 text-lg font-bold text-gray-900">FormEase</span>
            </div>

            <!-- Navigation Menu -->
            <nav class="p-4">
                <!-- Dashboard -->
                <a href="home.html" class="flex items-center px-3 py-2 text-blue-600 bg-blue-50 rounded-lg mb-2">
                    <i class="ri-dashboard-line mr-3 text-sm"></i>
                    <span class="text-sm font-medium">Overview</span>
                </a>

                <!-- Forms -->
                <div class="mt-4">
                    <h3 class="px-3 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">Formulaires</h3>
                    <a href="../forms/list.html" class="flex items-center px-3 py-2 text-gray-700 hover:bg-gray-100 rounded-lg mb-1">
                        <i class="ri-file-list-2-line mr-3 text-sm"></i>
                        <span class="text-sm">Mes formulaires</span>
                    </a>
                    <a href="../forms/builder.html" class="flex items-center px-3 py-2 text-gray-700 hover:bg-gray-100 rounded-lg mb-1">
                        <i class="ri-tools-line mr-3 text-sm"></i>
                        <span class="text-sm">Créateur</span>
                    </a>
                </div>

                <!-- Analytics -->
                <div class="mt-4">
                    <h3 class="px-3 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">Analytics</h3>
                    <a href="#" class="flex items-center px-3 py-2 text-gray-700 hover:bg-gray-100 rounded-lg mb-1">
                        <i class="ri-bar-chart-line mr-3 text-sm"></i>
                        <span class="text-sm">Statistiques</span>
                    </a>
                </div>

                <!-- Admin Section (visible uniquement pour Admin/Owner) -->
                <div class="mt-4 admin-only" style="display: none;">
                    <h3 class="px-3 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">Administration</h3>
                    <a href="#" class="flex items-center px-3 py-2 text-gray-700 hover:bg-gray-100 rounded-lg mb-1">
                        <i class="ri-user-settings-line mr-3 text-sm"></i>
                        <span class="text-sm">Gestion utilisateurs</span>
                    </a>
                    <a href="#" class="flex items-center px-3 py-2 text-gray-700 hover:bg-gray-100 rounded-lg mb-1">
                        <i class="ri-settings-3-line mr-3 text-sm"></i>
                        <span class="text-sm">Paramètres système</span>
                    </a>
                </div>

                <!-- Shortcuts -->
                <div class="mt-6 pt-4 border-t border-gray-200">
                    <h3 class="px-3 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">Shortcuts</h3>
                    <a href="#" class="flex items-center px-3 py-2 text-gray-700 hover:bg-gray-100 rounded-lg mb-1">
                        <i class="ri-user-add-line mr-3 text-sm"></i>
                        <span class="text-sm">Add new user</span>
                    </a>
                    <a href="#" class="flex items-center px-3 py-2 text-gray-700 hover:bg-gray-100 rounded-lg mb-1">
                        <i class="ri-settings-line mr-3 text-sm"></i>
                        <span class="text-sm">Settings</span>
                    </a>
                </div>

                <!-- User Profile -->
                <div class="mt-6 pt-4 border-t border-gray-200">
                    <div class="flex items-center px-3 py-2">
                        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                            <span class="text-white text-xs font-medium">JK</span>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium text-gray-900">Jeff KOSI</p>
                            <p class="text-xs text-gray-600">Member</p>
                        </div>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="bg-white rounded-lg shadow-sm border border-gray-200 min-h-[calc(100vh-4rem)]">
            <!-- Header avec titre et informations utilisateur -->
            <div class="border-b border-gray-200 px-6 py-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">Dashboard</h1>
                        <p class="text-gray-600 text-sm mt-1" id="dashboard-subtitle">Vue d'ensemble de vos performances</p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <button class="px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50">
                            Edit
                        </button>
                        <div class="flex items-center space-x-2">
                            <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                                <span class="text-white text-xs font-medium">JK</span>
                            </div>
                            <div class="text-right">
                                <p class="text-sm font-medium text-gray-900" id="userName">Jeff KOSI</p>
                                <p class="text-xs font-medium px-2 py-1 rounded" id="userRole">Premium</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contenu du dashboard -->
            <div class="p-6">
                <!-- Stats Cards basées sur le rôle -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8" id="main-stats">
                    <!-- Les métriques seront générées dynamiquement -->
                </div>

                <!-- Sections conditionnelles -->
                
                <!-- Section Revenus (Premium/Owner/Admin seulement) -->
                <div class="revenue-section mb-8" style="display: none;">
                    <div class="bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">Revenus & Performance</h3>
                                <p class="text-sm text-gray-600">Suivi financier et objectifs</p>
                            </div>
                            <i class="ri-money-euro-circle-line text-2xl text-green-600"></i>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="text-center">
                                <p class="text-2xl font-bold text-green-700" id="total-revenue">€0</p>
                                <p class="text-sm text-gray-600">Revenus totaux</p>
                            </div>
                            <div class="text-center">
                                <p class="text-2xl font-bold text-blue-700" id="monthly-goal">€0</p>
                                <p class="text-sm text-gray-600">Objectif mensuel</p>
                            </div>
                            <div class="text-center">
                                <p class="text-2xl font-bold text-purple-700" id="conversion-rate">0%</p>
                                <p class="text-sm text-gray-600">Taux de conversion</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section Admin (Admin seulement) -->
                <div class="admin-section mb-8" style="display: none;">
                    <div class="bg-gradient-to-r from-red-50 to-pink-50 border border-red-200 rounded-lg p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">Administration Système</h3>
                                <p class="text-sm text-gray-600">Vue d'ensemble de la plateforme</p>
                            </div>
                            <i class="ri-admin-line text-2xl text-red-600"></i>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="text-center">
                                <p class="text-2xl font-bold text-red-700" id="total-users">0</p>
                                <p class="text-sm text-gray-600">Utilisateurs totaux</p>
                            </div>
                            <div class="text-center">
                                <p class="text-2xl font-bold text-orange-700" id="active-projects">0</p>
                                <p class="text-sm text-gray-600">Projets actifs</p>
                            </div>
                            <div class="text-center">
                                <p class="text-2xl font-bold text-yellow-700" id="server-load">0%</p>
                                <p class="text-sm text-gray-600">Charge serveur</p>
                            </div>
                            <div class="text-center">
                                <p class="text-2xl font-bold text-green-700" id="system-health">0%</p>
                                <p class="text-sm text-gray-600">Santé système</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section Freemium (Upgrade prompt) -->
                <div class="freemium-section mb-8" style="display: none;">
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">Passez à Premium</h3>
                                <p class="text-sm text-gray-600">Débloquez toutes les fonctionnalités</p>
                            </div>
                            <i class="ri-vip-crown-line text-2xl text-blue-600"></i>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <p class="text-lg font-semibold text-blue-700 mb-2">Limites actuelles:</p>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• <span id="forms-used">0</span>/<span id="forms-limit">5</span> formulaires</li>
                                    <li>• <span id="responses-used">0</span> réponses ce mois</li>
                                    <li>• Analytics limitées</li>
                                </ul>
                            </div>
                            <div class="text-center">
                                <p class="text-3xl font-bold text-blue-700 mb-2" id="upgrade-discount">30%</p>
                                <p class="text-sm text-gray-600 mb-4">de réduction</p>
                                <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                    Upgrader maintenant
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Graphiques (conditionnels selon le rôle) -->
                <div class="charts-section">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                        <!-- Graphique principal -->
                        <div class="lg:col-span-2 bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                            <div class="mb-6">
                                <h3 class="text-lg font-semibold text-gray-900" id="main-chart-title">Activité & Engagement</h3>
                                <p class="text-sm text-gray-600 mt-1" id="main-chart-subtitle">Vue d'ensemble de l'activité</p>
                            </div>
                            <div id="mainChart" class="h-96"></div>
                        </div>

                        <!-- Panneau latéral -->
                        <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                            <div class="mb-6">
                                <h3 class="text-lg font-semibold text-gray-900">Métriques Clés</h3>
                                <p class="text-sm text-gray-600 mt-1">Indicateurs temps réel</p>
                            </div>
                            <div id="sidePanel" class="space-y-4">
                                <!-- Contenu généré dynamiquement -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ============================================
        // SYSTÈME DE GESTION DES RÔLES UTILISATEUR
        // ============================================
        
        const USER_ROLES = {
            ADMIN: 'admin',
            OWNER: 'owner', 
            PREMIUM: 'premium',
            FREEMIUM: 'freemium'
        };

        // Changez le rôle ici pour tester différents utilisateurs
        const currentUser = {
            id: 'user_123',
            name: 'Jeff KOSI',
            email: 'jeff.kosi@formease.com',
            role: USER_ROLES.PREMIUM // Changez ici: ADMIN, OWNER, PREMIUM, FREEMIUM
        };

        // Configuration des données par rôle
        const roleData = {
            [USER_ROLES.ADMIN]: {
                badge: { text: 'Admin', class: 'text-red-600 bg-red-100' },
                subtitle: 'Administration système - Vue globale',
                stats: {
                    totalForms: 1247,
                    activeForms: 892,
                    responses: 45230,
                    revenue: 156780,
                    conversionRate: 96.8,
                    totalUsers: 5847,
                    systemHealth: 99.9,
                    activeProjects: 324,
                    serverLoad: 45.2
                },
                sections: ['revenue-section', 'admin-section'],
                chartTitle: 'Analytics Système Globales'
            },
            [USER_ROLES.OWNER]: {
                badge: { text: 'Owner', class: 'text-purple-600 bg-purple-100' },
                subtitle: 'Gestion de projet - Vue propriétaire',
                stats: {
                    totalForms: 156,
                    activeForms: 123,
                    responses: 8934,
                    revenue: 45230,
                    conversionRate: 94.2,
                    totalUsers: 247,
                    systemHealth: 99.7,
                    activeProjects: 23,
                    teamMembers: 12
                },
                sections: ['revenue-section'],
                chartTitle: 'Performance de vos Projets'
            },
            [USER_ROLES.PREMIUM]: {
                badge: { text: 'Premium', class: 'text-blue-600 bg-blue-100' },
                subtitle: 'Compte Premium - Analytics avancées',
                stats: {
                    totalForms: 47,
                    activeForms: 34,
                    responses: 2847,
                    revenue: 12847,
                    conversionRate: 87.5,
                    monthlyGoal: 18000,
                    engagementRate: 94.2
                },
                sections: ['revenue-section'],
                chartTitle: 'Activité & Engagement Premium'
            },
            [USER_ROLES.FREEMIUM]: {
                badge: { text: 'Freemium', class: 'text-gray-600 bg-gray-100' },
                subtitle: 'Compte gratuit - Fonctionnalités limitées',
                stats: {
                    totalForms: 3,
                    activeForms: 2,
                    responses: 156,
                    conversionRate: 76.3,
                    formsLimit: 5,
                    responsesThisMonth: 156,
                    upgradeDiscount: 30
                },
                sections: ['freemium-section'],
                chartTitle: 'Aperçu de vos Formulaires'
            }
        };

        // Initialisation de l'interface
        function initializeInterface() {
            const userData = roleData[currentUser.role];
            
            // Mise à jour du badge utilisateur
            const roleElement = document.getElementById('userRole');
            roleElement.textContent = userData.badge.text;
            roleElement.className = `text-xs font-medium px-2 py-1 rounded ${userData.badge.class}`;
            
            // Mise à jour du sous-titre
            document.getElementById('dashboard-subtitle').textContent = userData.subtitle;
            
            // Affichage des sections conditionnelles
            userData.sections.forEach(section => {
                const element = document.querySelector(`.${section}`);
                if (element) element.style.display = 'block';
            });
            
            // Affichage du menu admin si nécessaire
            if (currentUser.role === USER_ROLES.ADMIN || currentUser.role === USER_ROLES.OWNER) {
                document.querySelector('.admin-only').style.display = 'block';
            }
            
            // Génération des statistiques principales
            generateMainStats(userData.stats);
            
            // Mise à jour des sections spécifiques
            updateRoleSpecificSections(userData.stats);
            
            // Titre du graphique
            document.getElementById('main-chart-title').textContent = userData.chartTitle;
            
            // Génération du graphique
            generateChart();
        }

        function generateMainStats(stats) {
            const statsContainer = document.getElementById('main-stats');
            let statsHTML = '';
            
            // Statistiques communes
            statsHTML += `
                <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Total Formulaires</p>
                            <p class="text-3xl font-bold text-gray-900 mt-2">${stats.totalForms}</p>
                            <p class="text-sm text-emerald-600 mt-1">
                                <i class="ri-arrow-up-line"></i> Actifs: ${stats.activeForms || 'N/A'}
                            </p>
                        </div>
                        <div class="w-12 h-12 bg-blue-50 rounded-lg flex items-center justify-center">
                            <i class="ri-file-list-3-line text-blue-600 text-xl"></i>
                        </div>
                    </div>
                </div>
            `;
            
            statsHTML += `
                <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Réponses</p>
                            <p class="text-3xl font-bold text-gray-900 mt-2">${stats.responses.toLocaleString()}</p>
                            <p class="text-sm text-emerald-600 mt-1">
                                <i class="ri-arrow-up-line"></i> Ce mois
                            </p>
                        </div>
                        <div class="w-12 h-12 bg-emerald-50 rounded-lg flex items-center justify-center">
                            <i class="ri-message-2-line text-emerald-600 text-xl"></i>
                        </div>
                    </div>
                </div>
            `;
            
            statsHTML += `
                <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Taux de Conversion</p>
                            <p class="text-3xl font-bold text-gray-900 mt-2">${stats.conversionRate}%</p>
                            <p class="text-sm text-emerald-600 mt-1">
                                <i class="ri-arrow-up-line"></i> Excellent
                            </p>
                        </div>
                        <div class="w-12 h-12 bg-amber-50 rounded-lg flex items-center justify-center">
                            <i class="ri-trophy-line text-amber-600 text-xl"></i>
                        </div>
                    </div>
                </div>
            `;
            
            statsContainer.innerHTML = statsHTML;
        }

        function updateRoleSpecificSections(stats) {
            // Mise à jour section revenus
            if (stats.revenue) {
                document.getElementById('total-revenue').textContent = '€' + stats.revenue.toLocaleString();
                document.getElementById('monthly-goal').textContent = '€' + (stats.monthlyGoal || stats.revenue).toLocaleString();
                document.getElementById('conversion-rate').textContent = stats.conversionRate + '%';
            }
            
            // Mise à jour section admin
            if (stats.totalUsers) {
                document.getElementById('total-users').textContent = stats.totalUsers.toLocaleString();
                document.getElementById('active-projects').textContent = stats.activeProjects;
                document.getElementById('server-load').textContent = stats.serverLoad + '%';
                document.getElementById('system-health').textContent = stats.systemHealth + '%';
            }
            
            // Mise à jour section freemium
            if (stats.formsLimit) {
                document.getElementById('forms-used').textContent = stats.totalForms;
                document.getElementById('forms-limit').textContent = stats.formsLimit;
                document.getElementById('responses-used').textContent = stats.responsesThisMonth;
                document.getElementById('upgrade-discount').textContent = stats.upgradeDiscount + '%';
            }
        }

        function generateChart() {
            // Données simplifiées pour le graphique
            const chartData = [45, 52, 48, 61, 55, 67, 59, 73, 68, 82, 75, 89];
            const chartOptions = {
                chart: {
                    type: 'area',
                    height: 384,
                    toolbar: { show: false }
                },
                series: [{
                    name: 'Activité',
                    data: chartData
                }],
                xaxis: {
                    categories: ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Jun', 'Jul', 'Aoû', 'Sep', 'Oct', 'Nov', 'Déc']
                },
                colors: ['#3b82f6'],
                fill: {
                    type: 'gradient',
                    gradient: {
                        shadeIntensity: 0.25,
                        opacityFrom: 0.7,
                        opacityTo: 0.1
                    }
                },
                stroke: {
                    curve: 'smooth',
                    width: 2
                }
            };
            
            const chart = new ApexCharts(document.querySelector('#mainChart'), chartOptions);
            chart.render();
        }

        // Initialisation au chargement de la page
        document.addEventListener('DOMContentLoaded', initializeInterface);
    </script>
</body>
</html>
